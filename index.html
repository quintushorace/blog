<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/blog/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/blog/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/blog/atom.xml" title="浩子" type="application/atom+xml" />






<meta name="description" content="宁静以致远">
<meta property="og:type" content="website">
<meta property="og:title" content="浩子">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="浩子">
<meta property="og:description" content="宁静以致远">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="浩子">
<meta name="twitter:description" content="宁静以致远">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>浩子</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

      <a href="https://github.com/quintushorace" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">浩子</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">学无止境</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/blog/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/2019/01/17/adb-命令大全/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Horace Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2019/01/17/adb-命令大全/" itemprop="url">adb 命令大全</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-17T10:25:04+08:00">
                2019-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  12,589
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  56
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="adb-命令大全"><a href="#adb-命令大全" class="headerlink" title="adb 命令大全"></a>adb 命令大全</h2><p>转自 <a href="https://blog.csdn.net/zhonglunshun/article/details/78362439" target="_blank" rel="noopener">https://blog.csdn.net/zhonglunshun/article/details/78362439</a></p>
<p> <strong>此文章内容整合自网络，欢迎转载。</strong></p>
<h2 id="ADB是什么"><a href="#ADB是什么" class="headerlink" title="ADB是什么"></a>ADB是什么</h2><hr>
<p> Adb的全称为Android Debug Bridge：android调试桥梁，下图为Android官方对adb的介绍：<br> <img src="http://upload-images.jianshu.io/upload_images/1888909-6b953b11bddfae15.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="这里写图片描述"><br> 可以看出，Android的初衷是用adb这样的一个工具来协助开发人员在开发android应用的过程中更快更好的调试apk，因此adb具有安装卸载apk、拷贝推送文件、查看设备硬件信息、查看应用程序占用资源、在设备执行shell命令等功能；</p>
<p> 我们可以在android sdk安装目录的platform-tools目录下找到adb工具；</p>
<h2 id="ADB架构"><a href="#ADB架构" class="headerlink" title="ADB架构"></a>ADB架构</h2><hr>
<p> 为了方便理解，我们从三个指令入手，我们经常会用到adb start-server，adb devices,adb kill-server。<br> 然后我们经常会看到这样的输出界面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\dell&gt;adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">* daemon not running. starting it now at tcp:5037 *</span><br><span class="line">* daemon started successfully *</span><br></pre></td></tr></table></figure>
<p> 于是这里有三点疑问，为什么是server，server对应的是服务器或者服务端吧？如果手机是客户端，服务端是不是指电脑上开启的服务。还有这个呆萌（daemon ）又是啥？</p>
<p> ADB是一个C/S架构的应用程序，由三部分组成：</p>
<ol start="2">
<li>运行在pc端的adb client：<br> 命令行程序”adb”用于从shell或脚本中运行adb命令。首先，“adb”程序尝试定位主机上的ADB服务器，如果找不到ADB服务器，“adb”程序自动启动一个ADB服务器。接下来，当设备的adbd和pc端的adb server建立连接后，adb client就可以向ADB servcer发送服务请求；</li>
<li>运行在pc端的adb server：<br> ADB Server是运行在主机上的一个后台进程。它的作用在于检测USB端口感知设备的连接和拔除，以及模拟器实例的启动或停止，ADB Server还需要将adb client的请求通过usb或者tcp的方式发送到对应的adbd上；</li>
<li>运行在设备端的常驻进程adb demon (adbd)：<br> 程序“adbd”作为一个后台进程在Android设备或模拟器系统中运行。它的作用是连接ADB服务器，并且为运行在主机上的客户端提供一些服务；<br> <img src="http://upload-images.jianshu.io/upload_images/1888909-4d3f0bec471b5dfc.png?imageMogr2/auto-orient/strip" alt="这里写图片描述"><br> <img src="http://upload-images.jianshu.io/upload_images/1888909-2a4a68b3d96ee4b3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="这里写图片描述">  <h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2></li>
</ol>
<hr>
<p> adb能做什么?答案是所有能对手机的操作都能用adb实现。也就是说如果你玩的6，你就是触摸屏完全坏了，显示屏完全坏了，就只是给你一个主板，你照样能完成你要做的动作。当然在一般场景不推荐这样做，效率优先嘛。</p>
<p> 接下来的内容是转自github上一位大牛的<a href="https://github.com/mzlogin/awesome-adb" target="_blank" rel="noopener">博客</a>，如有侵权请告知，立即删除；<br> 后期</p>
<h3 id="命令语法"><a href="#命令语法" class="headerlink" title="命令语法"></a>命令语法</h3><p> adb 命令的基本语法如下：</p>
<blockquote>
<p>adb [-d|-e|-s ]</p>
<p> 如果只有一个设备/模拟器连接时，可以省略掉 [-d|-e|-s ] 这一部分，直接使用 adb 。</p>
</blockquote>
<h3 id="为命令指定目标设备"><a href="#为命令指定目标设备" class="headerlink" title="为命令指定目标设备"></a>为命令指定目标设备</h3><p> 如果有多个设备/模拟器连接，则需要为命令指定目标设备。</p>
<pre><code>参数                      | 含义                              
----------------------- | --------------------------------
-d                      | 指定当前唯一通过 USB 连接的 Android 设备为命令目标
-e                      | 指定当前唯一运行的模拟器为命令目标               
-s &amp;lt;serialNumber&amp;gt; | 指定相应 serialNumber 号的设备/模拟器为命令目标
</code></pre><p> 在多个设备/模拟器连接的情况下较常用的是 -s 参数，serialNumber 可以通过 adb devices 命令获取。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ adb devices</span><br><span class="line"></span><br><span class="line">List of devices attached</span><br><span class="line">cf264b8f    device</span><br><span class="line">emulator-5554   device</span><br><span class="line">10.129.164.6:5555   device</span><br></pre></td></tr></table></figure>
<p> 输出里的 cf264b8f、emulator-5554 和 10.129.164.6:5555 即为 serialNumber。</p>
<p> 比如这时想指定 cf264b8f 这个设备来运行 adb 命令获取屏幕分辨率：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb -s cf264b8f shell wm size</span><br></pre></td></tr></table></figure>
<p> 又如想给 10.129.164.6:5555 这个设备安装应用（这种形式的 serialNumber 格式为 :，一般为无线连接的设备或 Genymotion 等第三方 Android 模拟器）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb -s 10.129.164.6:5555 install test.apk</span><br></pre></td></tr></table></figure>
<p> <em>遇到多设备/模拟器的情况均使用这几个参数为命令指定目标设备，下文中为简化描述，不再重复。</em></p>
<h3 id="启动-停止"><a href="#启动-停止" class="headerlink" title="启动/停止"></a>启动/停止</h3><p> 启动 adb server 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb start-server</span><br></pre></td></tr></table></figure>
<p> （一般无需手动执行此命令，在运行 adb 命令时若发现 adb server 没有启动会自动调起。）</p>
<p> 停止 adb server 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb kill-server</span><br></pre></td></tr></table></figure>
<h3 id="查看-adb-版本"><a href="#查看-adb-版本" class="headerlink" title="查看 adb 版本"></a>查看 adb 版本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb version</span><br></pre></td></tr></table></figure>
<p> 示例输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Android Debug Bridge version 1.0.36</span><br><span class="line">Revision 8f855a3d9b35-android</span><br></pre></td></tr></table></figure>
<h3 id="以-root-权限运行-adbd"><a href="#以-root-权限运行-adbd" class="headerlink" title="以 root 权限运行 adbd"></a>以 root 权限运行 adbd</h3><p> adb 的运行原理是 PC 端的 adb server 与手机端的守护进程 adbd 建立连接，然后 PC 端的 adb client 通过 adb server 转发命令，adbd 接收命令后解析运行。</p>
<p> 所以如果 adbd 以普通权限执行，有些需要 root 权限才能执行的命令无法直接用 adb xxx 执行。这时可以 adb shell 然后 su 后执行命令，也可以让 adbd 以 root 权限执行，这个就能随意执行高权限命令了。</p>
<p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb root</span><br></pre></td></tr></table></figure>
<p> 正常输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">restarting adbd as root</span><br></pre></td></tr></table></figure>
<p> 现在再运行 adb shell，看看命令行提示符是不是变成 # 了？</p>
<p> 有些手机 root 后也无法通过 adb root 命令让 adbd 以 root 权限执行，比如三星的部分机型，会提示 adbd cannot run as root in production builds，此时可以先安装 <strong>adbd Insecure</strong>，然后 adb root 试试。</p>
<p> 相应地，如果要恢复 adbd 为非 root 权限的话，可以使用 <strong>adb unroot</strong> 命令。</p>
<h3 id="指定-adb-server-的网络端口"><a href="#指定-adb-server-的网络端口" class="headerlink" title="指定 adb server 的网络端口"></a>指定 adb server 的网络端口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb -P &lt;port&gt; start-server</span><br></pre></td></tr></table></figure>
<p> 默认端口为 5037。</p>
<h2 id="设备连接管理"><a href="#设备连接管理" class="headerlink" title="设备连接管理"></a>设备连接管理</h2><hr>
<h3 id="查询已连接设备-模拟器"><a href="#查询已连接设备-模拟器" class="headerlink" title="查询已连接设备/模拟器"></a>查询已连接设备/模拟器</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List of devices attached</span><br><span class="line">cf264b8f    device</span><br><span class="line">emulator-5554   device</span><br><span class="line">10.129.164.6:5555   device</span><br></pre></td></tr></table></figure>
<p> 输出格式为 [serialNumber] [state]，serialNumber 即我们常说的 SN，state 有如下几种：</p>
<p> offline —— 表示设备未连接成功或无响应。</p>
<p> device —— 设备已连接。注意这个状态并不能标识 Android 系统已经完全启动和可操作，在设备启动过程中设备实例就可连接到 adb，但启动完毕后系统才处于可操作状态。</p>
<p> no device —— 没有设备/模拟器连接。</p>
<p> 以上输出显示当前已经连接了三台设备/模拟器，cf264b8f、emulator-5554 和 10.129.164.6:5555 分别是它们的 SN。从 emulator-5554 这个名字可以看出它是一个 Android 模拟器，而 10.129.164.6:5555 这种形为 : 的 serialNumber 一般是无线连接的设备或 Genymotion 等第三方 Android 模拟器。</p>
<p> 常见异常输出：</p>
<p> 没有设备/模拟器连接成功。</p>
<p> List of devices attached<br> 设备/模拟器未连接到 adb 或无响应。</p>
<p> List of devices attached<br> cf264b8f offline</p>
<h3 id="USB-连接"><a href="#USB-连接" class="headerlink" title="USB 连接"></a>USB 连接</h3><p> 通过 USB 连接来正常使用 adb 需要保证几点：</p>
<p> 硬件状态正常。</p>
<p> 包括 Android 设备处于正常开机状态，USB 连接线和各种接口完好。</p>
<p> Android 设备的开发者选项和 USB 调试模式已开启。</p>
<p> 可以到「设置」-「开发者选项」-「Android 调试」查看。</p>
<p> 如果在设置里找不到开发者选项，那需要通过一个彩蛋来让它显示出来：在「设置」-「关于手机」连续点击「版本号」7 次。</p>
<p> 设备驱动状态正常。</p>
<p> 这一点貌似在 Linux 和 Mac OS X 下不用操心，在 Windows 下有可能遇到需要安装驱动的情况，确认这一点可以右键「计算机」-「属性」，到「设备管理器」里查看相关设备上是否有黄色感叹号或问号，如果没有就说明驱动状态已经好了。否则可以下载一个手机助手类程序来安装驱动先。</p>
<p> 通过 USB 线连接好电脑和设备后确认状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br></pre></td></tr></table></figure>
<p> 如果能看到<br> xxxxxx device<br> 说明连接成功。</p>
<h3 id="无线连接（需要借助-USB-线）"><a href="#无线连接（需要借助-USB-线）" class="headerlink" title="无线连接（需要借助 USB 线）"></a>无线连接（需要借助 USB 线）</h3><p> 除了可以通过 USB 连接设备与电脑来使用 adb，也可以通过无线连接——虽然连接过程中也有需要使用 USB 的步骤，但是连接成功之后你的设备就可以在一定范围内摆脱 USB 连接线的限制啦！</p>
<p> 操作步骤：<br> 将 Android 设备与要运行 adb 的电脑连接到同一个局域网，比如连到同一个 WiFi。<br> 将设备与电脑通过 USB 线连接。<br> 应确保连接成功（可运行 adb devices 看是否能列出该设备）。<br> 让设备在 5555 端口监听 TCP/IP 连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb tcpip 5555</span><br></pre></td></tr></table></figure>
<p> 断开 USB 连接。<br> 找到设备的 IP 地址。<br> 一般能在「设置」-「关于手机」-「状态信息」-「IP地址」找到，也可以使用下文里 查看设备信息 - IP 地址 一节里的方法用 adb 命令来查看。</p>
<p> 通过 IP 地址连接设备。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb connect &lt;device-ip-address&gt;</span><br></pre></td></tr></table></figure>
<p> 这里的 就是上一步中找到的设备 IP 地址。</p>
<p> 确认连接状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br></pre></td></tr></table></figure>
<p> 如果能看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;device-ip-address&gt;:5555 device</span><br></pre></td></tr></table></figure>
<p> 说明连接成功。<br> 如果连接不了，请确认 Android 设备与电脑是连接到了同一个 WiFi，然后再次执行  <code>adb connect &lt;device-ip-address&gt;</code>  那一步；<br> 如果还是不行的话，通过 adb kill-server 重新启动 adb 然后从头再来一次试试。</p>
<p> 断开无线连接<br> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb disconnect &lt;device-ip-address&gt;</span><br></pre></td></tr></table></figure>
<h3 id="无线连接（无需借助-USB-线）"><a href="#无线连接（无需借助-USB-线）" class="headerlink" title="无线连接（无需借助 USB 线）"></a>无线连接（无需借助 USB 线）</h3><p> 注：需要 root 权限。</p>
<p> 上一节「无线连接（需要借助 USB 线）」是官方文档里介绍的方法，需要借助于 USB 数据线来实现无线连接。<br> 既然我们想要实现无线连接，那能不能所有步骤下来都是无线的呢？答案是能的。<br> 在 Android 设备上安装一个终端模拟器。<br> 已经安装过的设备可以跳过此步。我使用的终端模拟器下载地址是：Terminal Emulator for Android Downloads<br> 将 Android 设备与要运行 adb 的电脑连接到同一个局域网，比如连到同一个 WiFi。<br> 打开 Android 设备上的终端模拟器，在里面依次运行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su</span><br><span class="line">setprop service.adb.tcp.port 5555</span><br></pre></td></tr></table></figure>
<p> 找到 Android 设备的 IP 地址。</p>
<p> 一般能在「设置」-「关于手机」-「状态信息」-「IP地址」找到，也可以使用下文里 查看设备信息 - IP 地址 一节里的方法用 adb 命令来查看。</p>
<p> 在电脑上通过 adb 和 IP 地址连接 Android 设备。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb connect &lt;device-ip-address&gt;</span><br></pre></td></tr></table></figure>
<p> 这里的 就是上一步中找到的设备 IP 地址。</p>
<p> 如果能看到 connected to :5555 这样的输出则表示连接成功。</p>
<p> <strong>节注一：</strong></p>
<p> 有的设备，比如小米 5S + MIUI 8.0 + Android 6.0.1 MXB48T，可能在第 5 步之前需要重启 adbd 服务，在设备的终端模拟器上运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">restart adbd</span><br></pre></td></tr></table></figure>
<p> 如果 restart 无效，尝试以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stop adbd</span><br><span class="line">start adbd</span><br></pre></td></tr></table></figure>
<h2 id="应用管理"><a href="#应用管理" class="headerlink" title="应用管理"></a>应用管理</h2><h3 id="查看应用列表"><a href="#查看应用列表" class="headerlink" title="查看应用列表"></a>查看应用列表</h3><p> 查看应用列表的基本命令格式是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm list packages [-f] [-d] [-e] [-s] [-3] [-i] [-u] [--user USER_ID] [FILTER]</span><br></pre></td></tr></table></figure>
<p> 即在 adb shell pm list packages 的基础上可以加一些参数进行过滤查看不同的列表，支持的过滤参数如下：</p>
<pre><code>参数             | 显示列表                   
-------------- | -----------------------
无              | 所有应用                   
-f             | 显示应用关联的 apk 文件         
-d             | 只显示 disabled 的应用       
-e             | 只显示 enabled 的应用        
-s             | 只显示系统应用                
-3             | 只显示第三方应用               
-i             | 显示应用的 installer        
-u             | 包含已卸载应用                
&amp;lt;FILTER&amp;gt; | 包名包含 &amp;lt;FILTER&amp;gt; 字符串
</code></pre><h3 id="所有应用"><a href="#所有应用" class="headerlink" title="所有应用"></a>所有应用</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm list packages</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package:com.android.smoketest</span><br><span class="line">package:com.example.android.livecubes</span><br><span class="line">package:com.android.providers.telephony</span><br><span class="line">package:com.google.android.googlequicksearchbox</span><br><span class="line">package:com.android.providers.calendar</span><br><span class="line">package:com.android.providers.media</span><br><span class="line">package:com.android.protips</span><br><span class="line">package:com.android.documentsui</span><br><span class="line">package:com.android.gallery</span><br><span class="line">package:com.android.externalstorage</span><br><span class="line">...</span><br><span class="line">// other packages here</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="系统应用"><a href="#系统应用" class="headerlink" title="系统应用"></a>系统应用</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm list packages -s</span><br></pre></td></tr></table></figure>
<h3 id="第三方应用"><a href="#第三方应用" class="headerlink" title="第三方应用"></a>第三方应用</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm list packages -3</span><br></pre></td></tr></table></figure>
<p> 包名包含某字符串的应用<br> 比如要查看包名包含字符串 mazhuang 的应用列表，命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm list packages mazhuang</span><br></pre></td></tr></table></figure>
<p> 当然也可以使用 grep 来过滤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm list packages | grep mazhuang</span><br></pre></td></tr></table></figure>
<h3 id="安装-APK"><a href="#安装-APK" class="headerlink" title="安装 APK"></a>安装 APK</h3><p> 命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install [-lrtsdg] &lt;path_to_apk&gt;</span><br></pre></td></tr></table></figure>
<p> 参数：</p>
<p> adb install 后面可以跟一些可选参数来控制安装 APK 的行为，可用参数及含义如下：</p>
<pre><code>参数 | 含义                                                                   
-- | ---------------------------------------------------------------------
-l | 将应用安装到保护目录 /mnt/asec                                                 
-r | 允许覆盖安装                                                               
-t | 允许安装 AndroidManifest.xml 里 application 指定 android:testOnly=&quot;true&quot; 的应用
-s | 将应用安装到 sdcard                                                        
-d | 允许降级覆盖安装                                                             
-g | 授予所有运行时权限                                                            
</code></pre><p> 运行命令后如果见到类似如下输出（状态为 Success）代表安装成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[100%] /data/local/tmp/1.apk</span><br><span class="line">    pkg: /data/local/tmp/1.apk</span><br><span class="line">Success</span><br></pre></td></tr></table></figure>
<p> 上面是当前最新版 v1.0.36 的 adb 的输出，会显示 push apk 文件到手机的进度百分比。</p>
<p> 使用旧版本 adb 的输出则是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">12040 KB/s (22205609 bytes in 1.801s)</span><br><span class="line">        pkg: /data/local/tmp/SogouInput_android_v8.3_sweb.apk</span><br><span class="line">Success</span><br></pre></td></tr></table></figure>
<p> 而如果状态为 Failure 则表示安装失败，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[100%] /data/local/tmp/map-20160831.apk</span><br><span class="line">        pkg: /data/local/tmp/map-20160831.apk</span><br><span class="line">Failure [INSTALL_FAILED_ALREADY_EXISTS]</span><br></pre></td></tr></table></figure>
<p> 常见安装失败输出代码、含义及可能的解决办法如下：</p>
<pre><code>输出                                                                  | 含义                                                     | 解决办法                                                           
------------------------------------------------------------------- | ------------------------------------------------------ | ---------------------------------------------------------------
INSTALL_FAILED_ALREADY_EXISTS                                       | 应用已经存在，或卸载了但没卸载干净                                      | adb install 时使用 -r 参数，或者先 adb uninstall &amp;lt;packagename&amp;gt; 再安装
INSTALL_FAILED_INVALID_APK                                          | 无效的 APK 文件                                             |                                                                
INSTALL_FAILED_INVALID_URI                                          | 无效的 APK 文件名                                            | 确保 APK 文件名里无中文                                                 
INSTALL_FAILED_INSUFFICIENT_STORAGE                                 | 空间不足                                                   | 清理空间                                                           
INSTALL_FAILED_DUPLICATE_PACKAGE                                    | 已经存在同名程序                                               |                                                                
INSTALL_FAILED_NO_SHARED_USER                                       | 请求的共享用户不存在                                             |                                                                
INSTALL_FAILED_UPDATE_INCOMPATIBLE                                  | 以前安装过同名应用，但卸载时数据没有移除；或者已安装该应用，但签名不一致                   | 先 adb uninstall &amp;lt;packagename&amp;gt; 再安装                        
INSTALL_FAILED_SHARED_USER_INCOMPATIBLE                             | 请求的共享用户存在但签名不一致                                        |                                                                
INSTALL_FAILED_MISSING_SHARED_LIBRARY                               | 安装包使用了设备上不可用的共享库                                       |                                                                
INSTALL_FAILED_REPLACE_COULDNT_DELETE                               | 替换时无法删除                                                |                                                                
INSTALL_FAILED_DEXOPT                                               | dex 优化验证失败或空间不足                                        |                                                                
INSTALL_FAILED_OLDER_SDK                                            | 设备系统版本低于应用要求                                           |                                                                
INSTALL_FAILED_CONFLICTING_PROVIDER                                 | 设备里已经存在与应用里同名的 content provider                        |                                                                
INSTALL_FAILED_NEWER_SDK                                            | 设备系统版本高于应用要求                                           |                                                                
INSTALL_FAILED_TEST_ONLY                                            | 应用是 test-only 的，但安装时没有指定 -t 参数                         |                                                                
INSTALL_FAILED_CPU_ABI_INCOMPATIBLE                                 | 包含不兼容设备 CPU 应用程序二进制接口的 native code                     |                                                                
INSTALL_FAILED_MISSING_FEATURE                                      | 应用使用了设备不可用的功能                                          |                                                                
INSTALL_FAILED_CONTAINER_ERROR                                      | 1. sdcard 访问失败;2. 应用签名与 ROM 签名一致，被当作内置应用。              | 1. 确认 sdcard 可用，或者安装到内置存储;2. 打包时不与 ROM 使用相同签名。                 
INSTALL_FAILED_INVALID_INSTALL_LOCATION                             | 1. 不能安装到指定位置;2. 应用签名与 ROM 签名一致，被当作内置应用。                | 1. 切换安装位置，添加或删除 -s 参数;2. 打包时不与 ROM 使用相同签名。                     
INSTALL_FAILED_MEDIA_UNAVAILABLE                                    | 安装位置不可用                                                | 一般为 sdcard，确认 sdcard 可用或安装到内置存储                                
INSTALL_FAILED_VERIFICATION_TIMEOUT                                 | 验证安装包超时                                                |                                                                
INSTALL_FAILED_VERIFICATION_FAILURE                                 | 验证安装包失败                                                |                                                                
INSTALL_FAILED_PACKAGE_CHANGED                                      | 应用与调用程序期望的不一致                                          |                                                                
INSTALL_FAILED_UID_CHANGED                                          | 以前安装过该应用，与本次分配的 UID 不一致                                | 清除以前安装过的残留文件                                                   
INSTALL_FAILED_VERSION_DOWNGRADE                                    | 已经安装了该应用更高版本                                           | 使用 -d 参数                                                       
INSTALL_FAILED_PERMISSION_MODEL_DOWNGRADE                           | 已安装 target SDK 支持运行时权限的同名应用，要安装的版本不支持运行时权限             |                                                                
INSTALL_PARSE_FAILED_NOT_APK                                        | 指定路径不是文件，或不是以 .apk 结尾                                  |                                                                
INSTALL_PARSE_FAILED_BAD_MANIFEST                                   | 无法解析的 AndroidManifest.xml 文件                           |                                                                
INSTALL_PARSE_FAILED_UNEXPECTED_EXCEPTION                           | 解析器遇到异常                                                |                                                                
INSTALL_PARSE_FAILED_NO_CERTIFICATES                                | 安装包没有签名                                                |                                                                
INSTALL_PARSE_FAILED_INCONSISTENT_CERTIFICATES                      | 已安装该应用，且签名与 APK 文件不一致                                  | 先卸载设备上的该应用，再安装                                                 
INSTALL_PARSE_FAILED_CERTIFICATE_ENCODING                           | 解析 APK 文件时遇到 CertificateEncodingException              |                                                                
INSTALL_PARSE_FAILED_BAD_PACKAGE_NAME                               | manifest 文件里没有或者使用了无效的包名                               |                                                                
INSTALL_PARSE_FAILED_BAD_SHARED_USER_ID                             | manifest 文件里指定了无效的共享用户 ID                              |                                                                
INSTALL_PARSE_FAILED_MANIFEST_MALFORMED                             | 解析 manifest 文件时遇到结构性错误                                 |                                                                
INSTALL_PARSE_FAILED_MANIFEST_EMPTY                                 | 在 manifest 文件里找不到找可操作标签（instrumentation 或 application） |                                                                
INSTALL_FAILED_INTERNAL_ERROR                                       | 因系统问题安装失败                                              |                                                                
INSTALL_FAILED_USER_RESTRICTED                                      | 用户被限制安装应用                                              |                                                                
INSTALL_FAILED_DUPLICATE_PERMISSION                                 | 应用尝试定义一个已经存在的权限名称                                      |                                                                
INSTALL_FAILED_NO_MATCHING_ABIS                                     | 应用包含设备的应用程序二进制接口不支持的 native code                       |                                                                
INSTALL_CANCELED_BY_USER                                            | 应用安装需要在设备上确认，但未操作设备或点了取消                               | 在设备上同意安装                                                       
INSTALL_FAILED_ACWF_INCOMPATIBLE                                    | 应用程序与设备不兼容                                             |                                                                
does not contain AndroidManifest.xml                                | 无效的 APK 文件                                             |                                                                
is not a valid zip file                                             | 无效的 APK 文件                                             |                                                                
Offline                                                             | 设备未连接成功                                                | 先将设备与 adb 连接成功                                                 
unauthorized                                                        | 设备未授权允许调试                                              |                                                                
error: device not found                                             | 没有连接成功的设备                                              | 先将设备与 adb 连接成功                                                 
protocol failure                                                    | 设备已断开连接                                                | 先将设备与 adb 连接成功                                                 
Unknown option: -s                                                  | Android 2.2 以下不支持安装到 sdcard                            | 不使用 -s 参数                                                      
No space left on device                                             | 空间不足                                                   | 清理空间                                                           
Permission denied … sdcard …                                        | sdcard 不可用                                             |                                                                
signatures do not match the previously installed version; ignoring! | 已安装该应用且签名不一致                                           | 先卸载设备上的该应用，再安装                                                 
</code></pre><p> 参考：<a href="https://github.com/aosp-mirror/platform_frameworks_base/blob/master/core/java/android/content/pm/PackageManager.java" target="_blank" rel="noopener">[PackageManager.java]</a></p>
<h3 id="adb-install-内部原理简介"><a href="#adb-install-内部原理简介" class="headerlink" title="adb install 内部原理简介"></a>adb install 内部原理简介</h3><p> adb install 实际是分三步完成：</p>
<ol start="2">
<li>push apk 文件到 /data/local/tmp。</li>
<li>调用 pm install 安装。</li>
<li>删除 /data/local/tmp 下的对应 apk 文件。  所以，必要的时候也可以根据这个步骤，手动分步执行安装过程。</li>
</ol>
<h3 id="卸载应用"><a href="#卸载应用" class="headerlink" title="卸载应用"></a>卸载应用</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb uninstall [-k] &lt;packagename&gt;</span><br></pre></td></tr></table></figure>
<p> <code>&lt;packagename&gt;</code>  表示应用的包名，-k 参数可选，表示卸载应用但保留数据和缓存目录。<br> 命令示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb uninstall com.qihoo360.mobilesafe</span><br></pre></td></tr></table></figure>
<p> 表示卸载 360 手机卫士。</p>
<h3 id="清除应用数据与缓存"><a href="#清除应用数据与缓存" class="headerlink" title="清除应用数据与缓存"></a>清除应用数据与缓存</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm clear &lt;packagename&gt;</span><br></pre></td></tr></table></figure>
<p> <code>&lt;packagename&gt;</code>  表示应用名包，这条命令的效果相当于在设置里的应用信息界面点击了「清除缓存」和「清除数据」。</p>
<p> 命令示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm clear com.qihoo360.mobilesafe</span><br></pre></td></tr></table></figure>
<p> 表示清除 360 手机卫士的数据和缓存。</p>
<h3 id="查看前台-Activity"><a href="#查看前台-Activity" class="headerlink" title="查看前台 Activity"></a>查看前台 Activity</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys activity activities | grep mFocusedActivity</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mFocusedActivity: ActivityRecord&#123;8079d7e u0 com.cyanogenmod.trebuchet/com.android.launcher3.Launcher t42&#125;</span><br></pre></td></tr></table></figure>
<p> 其中的  <code>com.cyanogenmod.trebuchet/com.android.launcher3.Launcher</code>  就是当前处于前台的 Activity。</p>
<h3 id="查看正在运行的-Services"><a href="#查看正在运行的-Services" class="headerlink" title="查看正在运行的 Services"></a>查看正在运行的 Services</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys activity services [&lt;packagename&gt;]</span><br></pre></td></tr></table></figure>
<p> <code>&lt;packagename&gt;</code>  参数不是必须的，指定  <code>&lt;packagename&gt;</code>  表示查看与某个包名相关的 Services，不指定表示查看所有 Services。</p>
<p> <code>&lt;packagename&gt;</code>  不一定要给出完整的包名，比如运行 adb shell dumpsys activity services org.mazhuang，那么包名 org.mazhuang.demo1、org.mazhuang.demo2 和 org.mazhuang123 等相关的 Services 都会列出来。</p>
<h3 id="查看应用详细信息"><a href="#查看应用详细信息" class="headerlink" title="查看应用详细信息"></a>查看应用详细信息</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys package &lt;packagename&gt;</span><br></pre></td></tr></table></figure>
<p> 输出中包含很多信息，包括 Activity Resolver Table、Registered ContentProviders、包名、userId、安装后的文件资源代码等路径、版本信息、权限信息和授予状态、签名版本信息等。</p>
<p> <code>&lt;packagename&gt;</code>  表示应用包名。</p>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">Activity Resolver Table:</span><br><span class="line">  Non-Data Actions:</span><br><span class="line">      android.intent.action.MAIN:</span><br><span class="line">        5b4cba8 org.mazhuang.guanggoo/.SplashActivity filter 5ec9dcc</span><br><span class="line">          Action: &quot;android.intent.action.MAIN&quot;</span><br><span class="line">          Category: &quot;android.intent.category.LAUNCHER&quot;</span><br><span class="line">          AutoVerify=false</span><br><span class="line"></span><br><span class="line">Registered ContentProviders:</span><br><span class="line">  org.mazhuang.guanggoo/com.tencent.bugly.beta.utils.BuglyFileProvider:</span><br><span class="line">    Provider&#123;7a3c394 org.mazhuang.guanggoo/com.tencent.bugly.beta.utils.BuglyFileProvider&#125;</span><br><span class="line"></span><br><span class="line">ContentProvider Authorities:</span><br><span class="line">  [org.mazhuang.guanggoo.fileProvider]:</span><br><span class="line">    Provider&#123;7a3c394 org.mazhuang.guanggoo/com.tencent.bugly.beta.utils.BuglyFileProvider&#125;</span><br><span class="line">      applicationInfo=ApplicationInfo&#123;7754242 org.mazhuang.guanggoo&#125;</span><br><span class="line"></span><br><span class="line">Key Set Manager:</span><br><span class="line">  [org.mazhuang.guanggoo]</span><br><span class="line">      Signing KeySets: 501</span><br><span class="line"></span><br><span class="line">Packages:</span><br><span class="line">  Package [org.mazhuang.guanggoo] (c1d7f):</span><br><span class="line">    userId=10394</span><br><span class="line">    pkg=Package&#123;55f714c org.mazhuang.guanggoo&#125;</span><br><span class="line">    codePath=/data/app/org.mazhuang.guanggoo-2</span><br><span class="line">    resourcePath=/data/app/org.mazhuang.guanggoo-2</span><br><span class="line">    legacyNativeLibraryDir=/data/app/org.mazhuang.guanggoo-2/lib</span><br><span class="line">    primaryCpuAbi=null</span><br><span class="line">    secondaryCpuAbi=null</span><br><span class="line">    versionCode=74 minSdk=15 targetSdk=25</span><br><span class="line">    versionName=1.1.74</span><br><span class="line">    splits=[base]</span><br><span class="line">    apkSigningVersion=2</span><br><span class="line">    applicationInfo=ApplicationInfo&#123;7754242 org.mazhuang.guanggoo&#125;</span><br><span class="line">    flags=[ HAS_CODE ALLOW_CLEAR_USER_DATA ALLOW_BACKUP ]</span><br><span class="line">    privateFlags=[ RESIZEABLE_ACTIVITIES ]</span><br><span class="line">    dataDir=/data/user/0/org.mazhuang.guanggoo</span><br><span class="line">    supportsScreens=[small, medium, large, xlarge, resizeable, anyDensity]</span><br><span class="line">    timeStamp=2017-10-22 23:50:53</span><br><span class="line">    firstInstallTime=2017-10-22 23:50:25</span><br><span class="line">    lastUpdateTime=2017-10-22 23:50:55</span><br><span class="line">    installerPackageName=com.miui.packageinstaller</span><br><span class="line">    signatures=PackageSignatures&#123;af09595 [53c7caa2]&#125;</span><br><span class="line">    installPermissionsFixed=true installStatus=1</span><br><span class="line">    pkgFlags=[ HAS_CODE ALLOW_CLEAR_USER_DATA ALLOW_BACKUP ]</span><br><span class="line">    requested permissions:</span><br><span class="line">      android.permission.READ_PHONE_STATE</span><br><span class="line">      android.permission.INTERNET</span><br><span class="line">      android.permission.ACCESS_NETWORK_STATE</span><br><span class="line">      android.permission.ACCESS_WIFI_STATE</span><br><span class="line">      android.permission.READ_LOGS</span><br><span class="line">      android.permission.WRITE_EXTERNAL_STORAGE</span><br><span class="line">      android.permission.READ_EXTERNAL_STORAGE</span><br><span class="line">    install permissions:</span><br><span class="line">      android.permission.INTERNET: granted=true</span><br><span class="line">      android.permission.ACCESS_NETWORK_STATE: granted=true</span><br><span class="line">      android.permission.ACCESS_WIFI_STATE: granted=true</span><br><span class="line">    User 0: ceDataInode=1155675 installed=true hidden=false suspended=false stopped=true notLaunched=false enabled=0</span><br><span class="line">      gids=[3003]</span><br><span class="line">      runtime permissions:</span><br><span class="line">        android.permission.READ_EXTERNAL_STORAGE: granted=true</span><br><span class="line">        android.permission.READ_PHONE_STATE: granted=true</span><br><span class="line">        android.permission.WRITE_EXTERNAL_STORAGE: granted=true</span><br><span class="line">    User 999: ceDataInode=0 installed=false hidden=false suspended=false stopped=true notLaunched=true enabled=0</span><br><span class="line">      gids=[3003]</span><br><span class="line">      runtime permissions:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Dexopt state:</span><br><span class="line">  [org.mazhuang.guanggoo]</span><br><span class="line">    Instruction Set: arm64</span><br><span class="line">      path: /data/app/org.mazhuang.guanggoo-2/base.apk</span><br><span class="line">      status: /data/app/org.mazhuang.guanggoo-2/oat/arm64/base.odex [compilation_filter=speed-profile, status=kOatUpToDa</span><br><span class="line">      te]</span><br></pre></td></tr></table></figure>
<h2 id="与应用交互"><a href="#与应用交互" class="headerlink" title="与应用交互"></a>与应用交互</h2><p> 主要是使用  <code>am &lt;command&gt;</code>  命令，常用的  <code>&lt;command&gt;</code>  如下：</p>
<pre><code>command                               | 用途                            
------------------------------------- | ------------------------------
start [options] &amp;lt;INTENT&amp;gt;        | 启动 &amp;lt;INTENT&amp;gt; 指定的 Activity
startservice [options] &amp;lt;INTENT&amp;gt; | 启动 &amp;lt;INTENT&amp;gt; 指定的 Service
broadcast [options] &amp;lt;INTENT&amp;gt;    | 发送 &amp;lt;INTENT&amp;gt; 指定的广播       
force-stop &amp;lt;packagename&amp;gt;        | 停止 &amp;lt;packagename&amp;gt; 相关的进程  
</code></pre><p> <code>&lt;INTENT&gt;</code>  参数很灵活，和写 Android 程序时代码里的 Intent 相对应。</p>
<p> 用于决定 intent 对象的选项如下：</p>
<pre><code>参数                   | 含义                                                                     
-------------------- | -----------------------------------------------------------------------
-a &amp;lt;ACTION&amp;gt;    | 指定 action，比如 android.intent.action.VIEW                                
-c &amp;lt;CATEGORY&amp;gt;  | 指定 category，比如 android.intent.category.APP_CONTACTS                    
-n &amp;lt;COMPONENT&amp;gt; | 指定完整 component 名，用于明确指定启动哪个 Activity，如 com.example.app/.ExampleActivity
</code></pre><p> <code>&lt;INTENT&gt;</code>  里还能带数据，就像写代码时的 Bundle 一样：</p>
<pre><code>参数                                                                         | 含义                                               
-------------------------------------------------------------------------- | -------------------------------------------------
--esn &amp;lt;EXTRA_KEY&amp;gt;                                                    | null 值（只有 key 名）                                 
`-e                                                                        | –es &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_STRING_VALUE&amp;gt;`
--ez &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_BOOLEAN_VALUE&amp;gt;                         | boolean 值                                        
--ei &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_INT_VALUE&amp;gt;                             | integer 值                                        
--el &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_LONG_VALUE&amp;gt;                            | long 值                                           
--ef &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_FLOAT_VALUE&amp;gt;                           | float 值                                          
--eu &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_URI_VALUE&amp;gt;                             | URI                                              
--ecn &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_COMPONENT_NAME_VALUE&amp;gt;                 | component name                                   
--eia &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_INT_VALUE&amp;gt;[,&amp;lt;EXTRA_INT_VALUE...]   | integer 数组                                       
--ela &amp;lt;EXTRA_KEY&amp;gt; &amp;lt;EXTRA_LONG_VALUE&amp;gt;[,&amp;lt;EXTRA_LONG_VALUE...] | long 数组                                          
</code></pre><h3 id="调起-Activity"><a href="#调起-Activity" class="headerlink" title="调起 Activity"></a>调起 Activity</h3><p> 命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start [options] &lt;INTENT&gt;</span><br></pre></td></tr></table></figure>
<p> 例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -n com.tencent.mm/.ui.LauncherUI</span><br></pre></td></tr></table></figure>
<p> 表示调起微信主界面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -n org.mazhuang.boottimemeasure/.MainActivity --es &quot;toast&quot; &quot;hello, world&quot;</span><br></pre></td></tr></table></figure>
<p> 表示调起 org.mazhuang.boottimemeasure/.MainActivity 并传给它 string 数据键值对 toast - hello, world。</p>
<h3 id="调起-Service"><a href="#调起-Service" class="headerlink" title="调起 Service"></a>调起 Service</h3><p> 命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am startservice [options] &lt;INTENT&gt;</span><br></pre></td></tr></table></figure>
<p> 例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am startservice -n com.tencent.mm/.plugin.accountsync.model.AccountAuthenticatorService</span><br></pre></td></tr></table></figure>
<p> 表示调起微信的某 Service。</p>
<h3 id="发送广播"><a href="#发送广播" class="headerlink" title="发送广播"></a>发送广播</h3><p> 命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am broadcast [options] &lt;INTENT&gt;</span><br></pre></td></tr></table></figure>
<p> 可以向所有组件广播，也可以只向指定组件广播。</p>
<p> 例如，向所有组件广播 BOOT_COMPLETED：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am broadcast -a android.intent.action.BOOT_COMPLETED</span><br></pre></td></tr></table></figure>
<p> 又例如，只向 org.mazhuang.boottimemeasure/.BootCompletedReceiver 广播 BOOT_COMPLETED：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am broadcast -a android.intent.action.BOOT_COMPLETED -n org.mazhuang.boottimemeasure/.BootCompletedReceiver</span><br></pre></td></tr></table></figure>
<p> 这类用法在测试的时候很实用，比如某个广播的场景很难制造，可以考虑通过这种方式来发送广播。<br> 既能发送系统预定义的广播，也能发送自定义广播。如下是部分系统预定义广播及正常触发时机：</p>
<pre><code>action                                          | 触发时机                       
----------------------------------------------- | ---------------------------
android.net.conn.CONNECTIVITY_CHANGE            | 网络连接发生变化                   
android.intent.action.SCREEN_ON                 | 屏幕点亮                       
android.intent.action.SCREEN_OFF                | 屏幕熄灭                       
android.intent.action.BATTERY_LOW               | 电量低，会弹出电量低提示框              
android.intent.action.BATTERY_OKAY              | 电量恢复了                      
android.intent.action.BOOT_COMPLETED            | 设备启动完毕                     
android.intent.action.DEVICE_STORAGE_LOW        | 存储空间过低                     
android.intent.action.DEVICE_STORAGE_OK         | 存储空间恢复                     
android.intent.action.PACKAGE_ADDED             | 安装了新的应用                    
android.net.wifi.STATE_CHANGE                   | WiFi 连接状态发生变化              
android.net.wifi.WIFI_STATE_CHANGED             | WiFi 状态变为启用/关闭/正在启动/正在关闭/未知
android.intent.action.BATTERY_CHANGED           | 电池电量发生变化                   
android.intent.action.INPUT_METHOD_CHANGED      | 系统输入法发生变化                  
android.intent.action.ACTION_POWER_CONNECTED    | 外部电源连接                     
android.intent.action.ACTION_POWER_DISCONNECTED | 外部电源断开连接                   
android.intent.action.DREAMING_STARTED          | 系统开始休眠                     
android.intent.action.DREAMING_STOPPED          | 系统停止休眠                     
android.intent.action.WALLPAPER_CHANGED         | 壁纸发生变化                     
android.intent.action.HEADSET_PLUG              | 插入耳机                       
android.intent.action.MEDIA_UNMOUNTED           | 卸载外部介质                     
android.intent.action.MEDIA_MOUNTED             | 挂载外部介质                     
android.os.action.POWER_SAVE_MODE_CHANGED       | 省电模式开启                     
</code></pre><p> <em>（以上广播均可使用 adb 触发）</em></p>
<h3 id="强制停止应用"><a href="#强制停止应用" class="headerlink" title="强制停止应用"></a>强制停止应用</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am force-stop &lt;packagename&gt;</span><br></pre></td></tr></table></figure>
<p> 命令示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am force-stop com.qihoo360.mobilesafe</span><br></pre></td></tr></table></figure>
<p> 表示停止 360 安全卫士的一切进程与服务。</p>
<h2 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h2><h3 id="复制设备里的文件到电脑"><a href="#复制设备里的文件到电脑" class="headerlink" title="复制设备里的文件到电脑"></a>复制设备里的文件到电脑</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb pull &lt;设备里的文件路径&gt; [电脑上的目录]</span><br></pre></td></tr></table></figure>
<p> 其中 电脑上的目录 参数可以省略，默认复制到当前目录。</p>
<p> 例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb pull /sdcard/sr.mp4 ~/tmp/</span><br></pre></td></tr></table></figure>
<p> <em>小技巧：</em>设备上的文件路径可能需要 root 权限才能访问，如果你的设备已经 root 过，可以先使用 adb shell 和 su 命令在 adb shell 里获取 root 权限后，先 cp /path/on/device /sdcard/filename 将文件复制到 sdcard，然后 adb pull /sdcard/filename /path/on/pc。</p>
<h3 id="复制电脑里的文件到设备"><a href="#复制电脑里的文件到设备" class="headerlink" title="复制电脑里的文件到设备"></a>复制电脑里的文件到设备</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push &lt;电脑上的文件路径&gt; &lt;设备里的目录&gt;</span><br></pre></td></tr></table></figure>
<p> 例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push ~/sr.mp4 /sdcard/</span><br></pre></td></tr></table></figure>
<p> <em>小技巧：</em>设备上的文件路径普通权限可能无法直接写入，如果你的设备已经 root 过，可以先 adb push /path/on/pc /sdcard/filename，然后 adb shell 和 su 在 adb shell 里获取 root 权限后，cp /sdcard/filename /path/on/device。</p>
<h2 id="模拟按键-输入"><a href="#模拟按键-输入" class="headerlink" title="模拟按键/输入"></a>模拟按键/输入</h2><p> 在 adb shell 里有个很实用的命令叫 input，通过它可以做一些有趣的事情。<br> input 命令的完整 help 信息如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Usage: input [&lt;source&gt;] &lt;command&gt; [&lt;arg&gt;...]</span><br><span class="line"></span><br><span class="line">The sources are:</span><br><span class="line">      mouse</span><br><span class="line">      keyboard</span><br><span class="line">      joystick</span><br><span class="line">      touchnavigation</span><br><span class="line">      touchpad</span><br><span class="line">      trackball</span><br><span class="line">      stylus</span><br><span class="line">      dpad</span><br><span class="line">      gesture</span><br><span class="line">      touchscreen</span><br><span class="line">      gamepad</span><br><span class="line"></span><br><span class="line">The commands and default sources are:</span><br><span class="line">      text &lt;string&gt; (Default: touchscreen)</span><br><span class="line">      keyevent [--longpress] &lt;key code number or name&gt; ... (Default: keyboard)</span><br><span class="line">      tap &lt;x&gt; &lt;y&gt; (Default: touchscreen)</span><br><span class="line">      swipe &lt;x1&gt; &lt;y1&gt; &lt;x2&gt; &lt;y2&gt; [duration(ms)] (Default: touchscreen)</span><br><span class="line">      press (Default: trackball)</span><br><span class="line">      roll &lt;dx&gt; &lt;dy&gt; (Default: trackball)</span><br></pre></td></tr></table></figure>
<p> 比如模拟点击：//在屏幕上点击坐标点x=50 y=250的位置。</p>
<blockquote>
<p>adb shell input tap 50 250</p>
<p> 比如使用 adb shell input keyevent 命令，不同的 keycode 能实现不同的功能，完整的 keycode 列表详见 KeyEvent，摘引部分我觉得有意思的如下：</p>
</blockquote>
<pre><code>keycode | 含义                  
------- | --------------------
3       | HOME 键              
4       | 返回键                 
5       | 打开拨号应用              
6       | 挂断电话                
24      | 增加音量                
25      | 降低音量                
26      | 电源键                 
27      | 拍照（需要在相机应用里）        
64      | 打开浏览器               
82      | 菜单键                 
85      | 播放/暂停               
86      | 停止播放                
87      | 播放下一首               
88      | 播放上一首               
122     | 移动光标到行首或列表顶部        
123     | 移动光标到行末或列表底部        
126     | 恢复播放                
127     | 暂停播放                
164     | 静音                  
176     | 打开系统设置              
187     | 切换应用                
207     | 打开联系人               
208     | 打开日历                
209     | 打开音乐                
210     | 打开计算器               
220     | 降低屏幕亮度              
221     | 提高屏幕亮度              
223     | 系统休眠                
224     | 点亮屏幕                
231     | 打开语音助手              
276     | 如果没有 wakelock 则让系统休眠
</code></pre><p> 下面是 input 命令的一些用法举例。</p>
<h3 id="电源键"><a href="#电源键" class="headerlink" title="电源键"></a>电源键</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db shell input keyevent 26</span><br></pre></td></tr></table></figure>
<p> 执行效果相当于按电源键。</p>
<h3 id="菜单键"><a href="#菜单键" class="headerlink" title="菜单键"></a>菜单键</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 82</span><br></pre></td></tr></table></figure>
<h3 id="HOME-键"><a href="#HOME-键" class="headerlink" title="HOME 键"></a>HOME 键</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 3</span><br></pre></td></tr></table></figure>
<h3 id="返回键"><a href="#返回键" class="headerlink" title="返回键"></a>返回键</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 4</span><br></pre></td></tr></table></figure>
<h3 id="音量控制"><a href="#音量控制" class="headerlink" title="音量控制"></a>音量控制</h3><p> <strong>增加音量：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 24</span><br></pre></td></tr></table></figure>
<p> <strong>降低音量：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 25</span><br></pre></td></tr></table></figure>
<p> <strong>静音：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 164</span><br></pre></td></tr></table></figure>
<h3 id="媒体控制"><a href="#媒体控制" class="headerlink" title="媒体控制"></a>媒体控制</h3><p> <strong>播放/暂停：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 85</span><br></pre></td></tr></table></figure>
<p> <strong>停止播放：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 86</span><br></pre></td></tr></table></figure>
<p> <strong>播放下一首：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 87</span><br></pre></td></tr></table></figure>
<p> <strong>播放上一首：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 88</span><br></pre></td></tr></table></figure>
<p> <strong>恢复播放：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 126</span><br></pre></td></tr></table></figure>
<p> <strong>暂停播放：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 127</span><br></pre></td></tr></table></figure>
<h3 id="点亮-熄灭屏幕"><a href="#点亮-熄灭屏幕" class="headerlink" title="点亮/熄灭屏幕"></a>点亮/熄灭屏幕</h3><p> 可以通过上文讲述过的模拟电源键来切换点亮和熄灭屏幕，但如果明确地想要点亮或者熄灭屏幕，那可以使用如下方法。</p>
<p> <strong>点亮屏幕：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 224</span><br></pre></td></tr></table></figure>
<p> <strong>熄灭屏幕：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input keyevent 223</span><br></pre></td></tr></table></figure>
<h3 id="滑动解锁"><a href="#滑动解锁" class="headerlink" title="滑动解锁"></a>滑动解锁</h3><p> 如果锁屏没有密码，是通过滑动手势解锁，那么可以通过 input swipe 来解锁。</p>
<p> 命令（参数以机型 Nexus 5，向上滑动手势解锁举例）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input swipe 300 1000 300 500</span><br></pre></td></tr></table></figure>
<p> 参数 300 1000 300 500 分别表示起始点x坐标 起始点y坐标 结束点x坐标 结束点y坐标。</p>
<h3 id="输入文本"><a href="#输入文本" class="headerlink" title="输入文本"></a>输入文本</h3><p> 在焦点处于某文本框时，可以通过 input 命令来输入文本。</p>
<p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input text hello</span><br></pre></td></tr></table></figure>
<p> 现在 hello 出现在文本框了。</p>
<h2 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h2><p> Android 系统的日志分为两部分，底层的 Linux 内核日志输出到 /proc/kmsg，Android 的日志输出到 /dev/log。</p>
<h3 id="Android-日志"><a href="#Android-日志" class="headerlink" title="Android 日志"></a>Android 日志</h3><p> 命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[adb] logcat [&lt;option&gt;] ... [&lt;filter-spec&gt;] ...</span><br></pre></td></tr></table></figure>
<p> 常用用法列举如下：</p>
<p> 按级别过滤日志</p>
<p> Android 的日志分为如下几个优先级（priority）：</p>
<ul>
<li>V —— Verbose（最低，输出得最多）  </li>
<li>D —— Debug I —— Info  </li>
<li>W —— Warning  </li>
<li>E —— Error  </li>
<li>F—— Fatal  </li>
<li><p>S —— Silent（最高，啥也不输出）  按某级别过滤日志则会将该级别及以上的日志输出。</p>
<p>比如，命令：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb logcat *:W</span><br></pre></td></tr></table></figure>
<p> 会将 Warning、Error、Fatal 和 Silent 日志输出。</p>
<p> （注： 在 macOS 下需要给 _:W 这样以 _ 作为 tag 的参数加双引号，如 adb logcat “_:W”，不然会报错 no matches found: _:W。）</p>
<p> <strong>按 tag 和级别过滤日志</strong></p>
<p> <code>&lt;filter-spec&gt;</code>  可以由多个  <code>&lt;tag&gt;[:priority]</code>  组成。</p>
<p> 比如，命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb logcat ActivityManager:I MyApp:D *:S</span><br></pre></td></tr></table></figure>
<p> 表示输出 tag ActivityManager 的 Info 以上级别日志，输出 tag MyApp 的 Debug 以上级别日志，及其它 tag 的 Silent 级别日志（即屏蔽其它 tag 日志）。</p>
<p> <strong>日志格式</strong></p>
<p> 可以用  <code>adb logcat -v &lt;format&gt;</code>  选项指定日志输出格式。</p>
<p> 日志支持按以下几种  <code>&lt;format&gt;</code> ：</p>
<ul>
<li><p>brief</p>
<p> 默认格式。格式为：</p>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;priority&gt;/&lt;tag&gt;(&lt;pid&gt;): &lt;message&gt;</span><br></pre></td></tr></table></figure>

 示例：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D/HeadsetStateMachine( 1785): Disconnected process message: 10, size: 0</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>process</p>
<p> 格式为：</p>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;priority&gt;(&lt;pid&gt;) &lt;message&gt;</span><br></pre></td></tr></table></figure>

 示例：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D( 1785) Disconnected process message: 10, size: 0  (HeadsetStateMachine)</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>tag</p>
<p> 格式为：</p>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;priority&gt;/&lt;tag&gt;: &lt;message&gt;</span><br></pre></td></tr></table></figure>

 示例：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D/HeadsetStateMachine: Disconnected process message: 10, size: 0</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>raw</p>
<p> 格式为：</p>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;message&gt;</span><br></pre></td></tr></table></figure>

 示例：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Disconnected process message: 10, size: 0</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>time</p>
<p> 格式为：</p>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;datetime&gt; &lt;priority&gt;/&lt;tag&gt;(&lt;pid&gt;): &lt;message&gt;</span><br></pre></td></tr></table></figure>

 示例：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">08-28 22:39:39.974 D/HeadsetStateMachine( 1785): Disconnected process message: 10, size: 0</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>threadtime</p>
<p> 格式为：</p>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;datetime&gt; &lt;pid&gt; &lt;tid&gt; &lt;priority&gt; &lt;tag&gt;: &lt;message&gt;</span><br></pre></td></tr></table></figure>

 示例：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">08-28 22:39:39.974  1785  1832 D HeadsetStateMachine: Disconnected process message: 10, size: 0</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>long</p>
<p> 格式为：</p>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ &lt;datetime&gt; &lt;pid&gt;:&lt;tid&gt; &lt;priority&gt;/&lt;tag&gt; ] &lt;message&gt;</span><br></pre></td></tr></table></figure>

 示例：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ 08-28 22:39:39.974  1785: 1832 D/HeadsetStateMachine ] Disconnected process message: 10, size: 0</span><br></pre></td></tr></table></figure>

 指定格式可与上面的过滤同时使用。比如：
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb logcat -v long ActivityManager:I *:S</span><br></pre></td></tr></table></figure>
<p> <strong>清空日志</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb logcat -c</span><br></pre></td></tr></table></figure>
<h3 id="内核日志"><a href="#内核日志" class="headerlink" title="内核日志"></a>内核日志</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dmesg</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;6&gt;[14201.684016] PM: noirq resume of devices complete after 0.982 msecs</span><br><span class="line">&lt;6&gt;[14201.685525] PM: early resume of devices complete after 0.838 msecs</span><br><span class="line">&lt;6&gt;[14201.753642] PM: resume of devices complete after 68.106 msecs</span><br><span class="line">&lt;4&gt;[14201.755954] Restarting tasks ... done.</span><br><span class="line">&lt;6&gt;[14201.771229] PM: suspend exit 2016-08-28 13:31:32.679217193 UTC</span><br><span class="line">&lt;6&gt;[14201.872373] PM: suspend entry 2016-08-28 13:31:32.780363596 UTC</span><br><span class="line">&lt;6&gt;[14201.872498] PM: Syncing filesystems ... done.</span><br></pre></td></tr></table></figure>
<p> 中括号里的 [14201.684016] 代表内核开始启动后的时间，单位为秒。</p>
<p> 通过内核日志我们可以做一些事情，比如衡量内核启动时间，在系统启动完毕后的内核日志里找到 Freeing init memory 那一行前面的时间就是。</p>
<h2 id="查看设备信息"><a href="#查看设备信息" class="headerlink" title="查看设备信息"></a>查看设备信息</h2><h3 id="型号"><a href="#型号" class="headerlink" title="型号"></a>型号</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell getprop ro.product.model</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<p> Nexus 5</p>
<h3 id="电池状况"><a href="#电池状况" class="headerlink" title="电池状况"></a>电池状况</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys battery</span><br></pre></td></tr></table></figure>
<p> 输入示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Current Battery Service state:</span><br><span class="line">AC powered: false</span><br><span class="line">USB powered: true</span><br><span class="line">Wireless powered: false</span><br><span class="line">status: 2</span><br><span class="line">health: 2</span><br><span class="line">present: true</span><br><span class="line">level: 44</span><br><span class="line">scale: 100</span><br><span class="line">voltage: 3872</span><br><span class="line">temperature: 280</span><br><span class="line">technology: Li-poly</span><br></pre></td></tr></table></figure>
<p> 其中 scale 代表最大电量，level 代表当前电量。上面的输出表示还剩下 44% 的电量。</p>
<h3 id="屏幕分辨率"><a href="#屏幕分辨率" class="headerlink" title="屏幕分辨率"></a>屏幕分辨率</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell wm size</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Physical size: 1080x1920</span><br></pre></td></tr></table></figure>
<p> 该设备屏幕分辨率为 1080px * 1920px。</p>
<p> 如果使用命令修改过，那输出可能是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Physical size: 1080x1920</span><br><span class="line">Override size: 480x1024</span><br></pre></td></tr></table></figure>
<p> 表明设备的屏幕分辨率原本是 1080px <em> 1920px，当前被修改为 480px </em> 1024px。</p>
<h3 id="屏幕密度"><a href="#屏幕密度" class="headerlink" title="屏幕密度"></a>屏幕密度</h3><p> 命令：</p>
<p> adb shell wm density<br> 输出示例：</p>
<p> Physical density: 420<br> 该设备屏幕密度为 420dpi。</p>
<p> 如果使用命令修改过，那输出可能是：</p>
<p> Physical density: 480<br> Override density: 160<br> 表明设备的屏幕密度原来是 480dpi，当前被修改为 160dpi。</p>
<h3 id="显示屏参数"><a href="#显示屏参数" class="headerlink" title="显示屏参数"></a>显示屏参数</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys window displays</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WINDOW MANAGER DISPLAY CONTENTS (dumpsys window displays)</span><br><span class="line">  Display: mDisplayId=0</span><br><span class="line">    init=1080x1920 420dpi cur=1080x1920 app=1080x1794 rng=1080x1017-1810x1731</span><br><span class="line">    deferred=false layoutNeeded=false</span><br></pre></td></tr></table></figure>
<p> 其中 mDisplayId 为 显示屏编号，init 是初始分辨率和屏幕密度，app 的高度比 init 里的要小，表示屏幕底部有虚拟按键，高度为 1920 - 1794 = 126px 合 42dp。</p>
<h3 id="android-id"><a href="#android-id" class="headerlink" title="android_id"></a>android_id</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings get secure android_id</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">51b6be48bac8c569</span><br></pre></td></tr></table></figure>
<h3 id="IMEI"><a href="#IMEI" class="headerlink" title="IMEI"></a>IMEI</h3><p> 在 Android 4.4 及以下版本可通过如下命令获取 IMEI：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys iphonesubinfo</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Phone Subscriber Info:</span><br><span class="line">  Phone Type = GSM</span><br><span class="line">  Device ID = 860955027785041</span><br><span class="line">其中的 Device ID 就是 IMEI。</span><br></pre></td></tr></table></figure>
<p> 而在 Android 5.0 及以上版本里这个命令输出为空，得通过其它方式获取了（需要 root 权限）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">service call iphonesubinfo 1</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Result: Parcel(</span><br><span class="line">  0x00000000: 00000000 0000000f 00360038 00390030 &apos;........8.6.0.9.&apos;</span><br><span class="line">  0x00000010: 00350035 00320030 00370037 00350038 &apos;5.5.0.2.7.7.8.5.&apos;</span><br><span class="line">  0x00000020: 00340030 00000031                   &apos;0.4.1...        &apos;)</span><br></pre></td></tr></table></figure>
<p> 把里面的有效内容提取出来就是 IMEI 了，比如这里的是 860955027785041。</p>
<p> 参考：adb shell dumpsys iphonesubinfo not working since Android 5.0 Lollipop</p>
<h3 id="Android-系统版本"><a href="#Android-系统版本" class="headerlink" title="Android 系统版本"></a>Android 系统版本</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell getprop ro.build.version.release</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<p> 5.0.2</p>
<h3 id="IP-地址"><a href="#IP-地址" class="headerlink" title="IP 地址"></a>IP 地址</h3><p> 每次想知道设备的 IP 地址的时候都得「设置」-「关于手机」-「状态信息」-「IP地址」很烦对不对？通过 adb 可以方便地查看。</p>
<p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell ifconfig | grep Mask</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inet addr:10.130.245.230  Mask:255.255.255.252</span><br><span class="line">inet addr:127.0.0.1  Mask:255.0.0.0</span><br></pre></td></tr></table></figure>
<p> 那么 10.130.245.230 就是设备 IP 地址。</p>
<p> 在有的设备上这个命令没有输出，如果设备连着 WiFi，可以使用如下命令来查看局域网 adb shell ifconfig wlan0例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wlan0: ip 10.129.160.99 mask 255.255.240.0 flags [up broadcast running multicast]</span><br></pre></td></tr></table></figure>
<p> 或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wlan0     Link encap:UNSPEC</span><br><span class="line">          inet addr:10.129.168.57  Bcast:10.129.175.255  Mask:255.255.240.0</span><br><span class="line">          inet6 addr: fe80::66cc:2eff:fe68:b6b6/64 Scope: Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:496520 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:68215 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:3000</span><br><span class="line">          RX bytes:116266821 TX bytes:8311736</span><br></pre></td></tr></table></figure>
<p> 如果以上命令仍然不能得到期望的信息，那可以试试以下命令（部分系统版本里可用）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell netcfg</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">wlan0    UP                               10.129.160.99/20  0x00001043 f8:a9:d0:17:42:4d</span><br><span class="line">lo       UP                                   127.0.0.1/8   0x00000049 00:00:00:00:00:00</span><br><span class="line">p2p0     UP                                     0.0.0.0/0   0x00001003 fa:a9:d0:17:42:4d</span><br><span class="line">sit0     DOWN                                   0.0.0.0/0   0x00000080 00:00:00:00:00:00</span><br><span class="line">rmnet0   DOWN                                   0.0.0.0/0   0x00000000 00:00:00:00:00:00</span><br><span class="line">rmnet1   DOWN                                   0.0.0.0/0   0x00000000 00:00:00:00:00:00</span><br><span class="line">rmnet3   DOWN                                   0.0.0.0/0   0x00000000 00:00:00:00:00:00</span><br><span class="line">rmnet2   DOWN                                   0.0.0.0/0   0x00000000 00:00:00:00:00:00</span><br><span class="line">rmnet4   DOWN                                   0.0.0.0/0   0x00000000 00:00:00:00:00:00</span><br><span class="line">rmnet6   DOWN                                   0.0.0.0/0   0x00000000 00:00:00:00:00:00</span><br><span class="line">rmnet5   DOWN                                   0.0.0.0/0   0x00000000 00:00:00:00:00:00</span><br><span class="line">rmnet7   DOWN                                   0.0.0.0/0   0x00000000 00:00:00:00:00:00</span><br><span class="line">rev_rmnet3 DOWN                                   0.0.0.0/0   0x00001002 4e:b7:e4:2e:17:58</span><br><span class="line">rev_rmnet2 DOWN                                   0.0.0.0/0   0x00001002 4e:f0:c8:bf:7a:cf</span><br><span class="line">rev_rmnet4 DOWN                                   0.0.0.0/0   0x00001002 a6:c0:3b:6b:c4:1f</span><br><span class="line">rev_rmnet6 DOWN                                   0.0.0.0/0   0x00001002 66:bb:5d:64:2e:e9</span><br><span class="line">rev_rmnet5 DOWN                                   0.0.0.0/0   0x00001002 0e:1b:eb:b9:23:a0</span><br><span class="line">rev_rmnet7 DOWN                                   0.0.0.0/0   0x00001002 7a:d9:f6:81:40:5a</span><br><span class="line">rev_rmnet8 DOWN                                   0.0.0.0/0   0x00001002 4e:e2:a9:bb:d0:1b</span><br><span class="line">rev_rmnet0 DOWN                                   0.0.0.0/0   0x00001002 fe:65:d0:ca:82:a9</span><br><span class="line">rev_rmnet1 DOWN                                   0.0.0.0/0   0x00001002 da:d8:e8:4f:2e:fe</span><br></pre></td></tr></table></figure>
<p> 可以看到网络连接名称、启用状态、IP 地址和 Mac 地址等信息。</p>
<h3 id="Mac-地址"><a href="#Mac-地址" class="headerlink" title="Mac 地址"></a>Mac 地址</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell cat /sys/class/net/wlan0/address</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f8:a9:d0:17:42:4d</span><br></pre></td></tr></table></figure>
<p> 这查看的是局域网 Mac 地址，移动网络或其它连接的信息可以通过前面的小节「IP 地址」里提到的 adb shell netcfg 命令来查看。</p>
<h3 id="CPU-信息"><a href="#CPU-信息" class="headerlink" title="CPU 信息"></a>CPU 信息</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell cat /proc/cpuinfo</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Processor       : ARMv7 Processor rev 0 (v7l)</span><br><span class="line">processor       : 0</span><br><span class="line">BogoMIPS        : 38.40</span><br><span class="line"></span><br><span class="line">processor       : 1</span><br><span class="line">BogoMIPS        : 38.40</span><br><span class="line"></span><br><span class="line">processor       : 2</span><br><span class="line">BogoMIPS        : 38.40</span><br><span class="line"></span><br><span class="line">processor       : 3</span><br><span class="line">BogoMIPS        : 38.40</span><br><span class="line"></span><br><span class="line">Features        : swp half thumb fastmult vfp edsp neon vfpv3 tls vfpv4 idiva idivt</span><br><span class="line">CPU implementer : 0x51</span><br><span class="line">CPU architecture: 7</span><br><span class="line">CPU variant     : 0x2</span><br><span class="line">CPU part        : 0x06f</span><br><span class="line">CPU revision    : 0</span><br><span class="line"></span><br><span class="line">Hardware        : Qualcomm MSM 8974 HAMMERHEAD (Flattened Device Tree)</span><br><span class="line">Revision        : 000b</span><br><span class="line">Serial          : 0000000000000000</span><br></pre></td></tr></table></figure>
<p> 这是 Nexus 5 的 CPU 信息，我们从输出里可以看到使用的硬件是 Qualcomm MSM 8974，processor 的编号是 0 到 3，所以它是四核的，采用的架构是 ARMv7 Processor rev 0 (v71)。</p>
<h3 id="内存信息"><a href="#内存信息" class="headerlink" title="内存信息"></a>内存信息</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell cat /proc/meminfo</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">MemTotal:        1027424 kB</span><br><span class="line">MemFree:          486564 kB</span><br><span class="line">Buffers:           15224 kB</span><br><span class="line">Cached:            72464 kB</span><br><span class="line">SwapCached:        24152 kB</span><br><span class="line">Active:           110572 kB</span><br><span class="line">Inactive:         259060 kB</span><br><span class="line">Active(anon):      79176 kB</span><br><span class="line">Inactive(anon):   207736 kB</span><br><span class="line">Active(file):      31396 kB</span><br><span class="line">Inactive(file):    51324 kB</span><br><span class="line">Unevictable:        3948 kB</span><br><span class="line">Mlocked:               0 kB</span><br><span class="line">HighTotal:        409600 kB</span><br><span class="line">HighFree:         132612 kB</span><br><span class="line">LowTotal:         617824 kB</span><br><span class="line">LowFree:          353952 kB</span><br><span class="line">SwapTotal:        262140 kB</span><br><span class="line">SwapFree:         207572 kB</span><br><span class="line">Dirty:                 0 kB</span><br><span class="line">Writeback:             0 kB</span><br><span class="line">AnonPages:        265324 kB</span><br><span class="line">Mapped:            47072 kB</span><br><span class="line">Shmem:              1020 kB</span><br><span class="line">Slab:              57372 kB</span><br><span class="line">SReclaimable:       7692 kB</span><br><span class="line">SUnreclaim:        49680 kB</span><br><span class="line">KernelStack:        4512 kB</span><br><span class="line">PageTables:         5912 kB</span><br><span class="line">NFS_Unstable:          0 kB</span><br><span class="line">Bounce:                0 kB</span><br><span class="line">WritebackTmp:          0 kB</span><br><span class="line">CommitLimit:      775852 kB</span><br><span class="line">Committed_AS:   13520632 kB</span><br><span class="line">VmallocTotal:     385024 kB</span><br><span class="line">VmallocUsed:       61004 kB</span><br><span class="line">VmallocChunk:     209668 kB</span><br></pre></td></tr></table></figure>
<p> 其中，MemTotal 就是设备的总内存，MemFree 是当前空闲内存。</p>
<h3 id="更多硬件与系统属性"><a href="#更多硬件与系统属性" class="headerlink" title="更多硬件与系统属性"></a>更多硬件与系统属性</h3><p> 设备的更多硬件与系统属性可以通过如下命令查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell cat /system/build.prop</span><br></pre></td></tr></table></figure>
<p> 这会输出很多信息，包括前面几个小节提到的「型号」和「Android 系统版本」等。</p>
<p> 输出里还包括一些其它有用的信息，它们也可通过 adb shell getprop &lt;属性名&gt; 命令单独查看，列举一部分属性如下：</p>
<pre><code>属性名                             | 含义                 
------------------------------- | -------------------
ro.build.version.sdk            | SDK 版本             
ro.build.version.release        | Android 系统版本       
ro.build.version.security_patch | Android 安全补丁程序级别   
ro.product.model                | 型号                 
ro.product.brand                | 品牌                 
ro.product.name                 | 设备名                
ro.product.board                | 处理器型号              
ro.product.cpu.abilist          | CPU 支持的 abi 列表[节注一]
persist.sys.isUsbOtgEnabled     | 是否支持 OTG           
dalvik.vm.heapsize              | 每个应用程序的内存上限        
ro.sf.lcd_density               | 屏幕密度               
</code></pre><p> <strong>节注一：</strong></p>
<p> 一些小厂定制的 ROM 可能修改过 CPU 支持的 abi 列表的属性名，如果用 ro.product.cpu.abilist 属性名查找不到，可以这样试试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell cat /system/build.prop | grep ro.product.cpu.abi</span><br></pre></td></tr></table></figure>
<p> 示例输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ro.product.cpu.abi=armeabi-v7a</span><br><span class="line">ro.product.cpu.abi2=armeabi</span><br></pre></td></tr></table></figure>
<h2 id="修改设置"><a href="#修改设置" class="headerlink" title="修改设置"></a>修改设置</h2><p> <em>注： 修改设置之后，运行恢复命令有可能显示仍然不太正常，可以运行 adb reboot 重启设备，或手动重启。</em></p>
<p> 修改设置的原理主要是通过 settings 命令修改 /data/data/com.android.providers.settings/databases/settings.db 里存放的设置值。</p>
<h3 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell wm size 480x1024</span><br></pre></td></tr></table></figure>
<p> 表示将分辨率修改为 480px * 1024px。</p>
<p> 恢复原分辨率命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell wm size reset</span><br></pre></td></tr></table></figure>
<h3 id="屏幕密度-1"><a href="#屏幕密度-1" class="headerlink" title="屏幕密度"></a>屏幕密度</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell wm density 160</span><br></pre></td></tr></table></figure>
<p> 表示将屏幕密度修改为 160dpi。</p>
<p> 恢复原屏幕密度命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell wm density reset</span><br></pre></td></tr></table></figure>
<h3 id="显示区域"><a href="#显示区域" class="headerlink" title="显示区域"></a>显示区域</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell wm overscan 0,0,0,200</span><br></pre></td></tr></table></figure>
<p> 四个数字分别表示距离左、上、右、下边缘的留白像素，以上命令表示将屏幕底部 200px 留白。</p>
<p> 恢复原显示区域命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell wm overscan reset</span><br></pre></td></tr></table></figure>
<h3 id="关闭-USB-调试模式"><a href="#关闭-USB-调试模式" class="headerlink" title="关闭 USB 调试模式"></a>关闭 USB 调试模式</h3><p> 命令：</p>
<p> adb shell settings put global adb_enabled 0<br> 恢复：</p>
<p> 用命令恢复不了了，毕竟关闭了 USB 调试 adb 就连接不上 Android 设备了。</p>
<p> 去设备上手动恢复吧：「设置」-「开发者选项」-「Android 调试」。</p>
<h3 id="状态栏和导航栏的显示隐藏"><a href="#状态栏和导航栏的显示隐藏" class="headerlink" title="状态栏和导航栏的显示隐藏"></a>状态栏和导航栏的显示隐藏</h3><p> 本节所说的相关设置对应 Cyanogenmod 里的「扩展桌面」。</p>
<p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings put global policy_control &lt;key-values&gt;</span><br></pre></td></tr></table></figure>
<p> <code>&lt;key-values&gt;</code>  可由如下几种键及其对应的值组成，格式为  <code>&lt;key1&gt;=&lt;value1&gt;:&lt;key2&gt;=&lt;value2&gt;</code> 。</p>
<pre><code>key                   | 含义   
--------------------- | -----
immersive.full        | 同时隐藏
immersive.status      | 隐藏状态栏
immersive.navigation  | 隐藏导航栏
immersive.preconfirms | ?    
</code></pre><p> 这些键对应的值可则如下值用逗号组合：</p>
<pre><code>value        | 含义    
------------ | ------
apps         | 所有应用  
*            | 所有界面  
packagename  | 指定应用  
-packagename | 排除指定应用
</code></pre><p> 例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings put global policy_control immersive.full=*</span><br></pre></td></tr></table></figure>
<p> 表示设置在所有界面下都同时隐藏状态栏和导航栏。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings put global policy_control immersive.status=com.package1,com.package2:immersive.navigation=apps,-com.package3</span><br></pre></td></tr></table></figure>
<p> 表示设置在包名为 com.package1 和 com.package2 的应用里隐藏状态栏，在除了包名为 com.package3 的所有应用里隐藏导航栏。</p>
<h4 id="恢复正常模式"><a href="#恢复正常模式" class="headerlink" title="恢复正常模式"></a>恢复正常模式</h4><p> 不想全屏了咋办呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings put global policy_control null</span><br></pre></td></tr></table></figure>
<h2 id="实用功能"><a href="#实用功能" class="headerlink" title="实用功能"></a>实用功能</h2><h3 id="屏幕截图"><a href="#屏幕截图" class="headerlink" title="屏幕截图"></a>屏幕截图</h3><p> <strong>截图保存到电脑：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb exec-out screencap -p &gt; sc.png</span><br></pre></td></tr></table></figure>
<p> 如果 adb 版本较老，无法使用 exec-out 命令，这时候建议更新 adb 版本。无法更新的话可以使用以下麻烦点的办法：</p>
<p> 先截图保存到设备里：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell screencap -p /sdcard/sc.png</span><br></pre></td></tr></table></figure>
<p> 然后将 png 文件导出到电脑：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb pull /sdcard/sc.png</span><br></pre></td></tr></table></figure>
<p> 可以使用 adb shell screencap -h 查看 screencap 命令的帮助信息，下面是两个有意义的参数及含义：</p>
<pre><code>参数            | 含义                   
------------- | ---------------------
-p            | 指定保存文件为 png 格式       
-d display-id | 指定截图的显示屏编号（有多显示屏的情况下）
</code></pre><p> 实测如果指定文件名以 .png 结尾时可以省略 -p 参数；否则需要使用 -p 参数。如果不指定文件名，截图文件的内容将直接输出到 stdout。</p>
<p> <strong>另外一种一行命令截图并保存到电脑的方法：</strong></p>
<p> Linux 和 Windows</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell screencap -p | sed &quot;s/\r$//&quot; &gt; sc.png</span><br></pre></td></tr></table></figure>
<p> Mac OS X</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell screencap -p | gsed &quot;s/\r$//&quot; &gt; sc.png</span><br></pre></td></tr></table></figure>
<p> 这个方法需要用到 gnu sed 命令，在 Linux 下直接就有，在 Windows 下 Git 安装目录的 bin 文件夹下也有。如果确实找不到该命令，可以下载 sed for Windows 并将 sed.exe 所在文件夹添加到 PATH 环境变量里。</p>
<p> 而在 Mac 下使用系统自带的 sed 命令会报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed: RE error: illegal byte sequence</span><br></pre></td></tr></table></figure>
<p> 需要安装 gnu-sed，然后使用 gsed 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install gnu-sed</span><br></pre></td></tr></table></figure>
<h3 id="录制屏幕"><a href="#录制屏幕" class="headerlink" title="录制屏幕"></a>录制屏幕</h3><p> 录制屏幕以 mp4 格式保存到 /sdcard：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell screenrecord /sdcard/filename.mp4</span><br></pre></td></tr></table></figure>
<p> 需要停止时按 Ctrl-C，默认录制时间和最长录制时间都是 180 秒。</p>
<p> 如果需要导出到电脑：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb pull /sdcard/filename.mp4</span><br></pre></td></tr></table></figure>
<p> 可以使用 adb shell screenrecord –help 查看 screenrecord 命令的帮助信息，下面是常见参数及含义：</p>
<pre><code>参数                 | 含义                         
------------------ | ---------------------------
–size WIDTHxHEIGHT | 视频的尺寸，比如 1280x720，默认是屏幕分辨率。
–bit-rate RATE     | 视频的比特率，默认是 4Mbps。          
–time-limit TIME   | 录制时长，单位秒。                  
–verbose           | 输出更多信息。                    
</code></pre><p> <strong>重新挂载 system 分区为可写</strong></p>
<p> <em>注：需要 root 权限。</em></p>
<p> /system 分区默认挂载为只读，但有些操作比如给 Android 系统添加命令、删除自带应用等需要对 /system 进行写操作，所以需要重新挂载它为可读写。</p>
<p> 步骤：</p>
<p> 进入 shell 并切换到 root 用户权限。</p>
<p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">su</span><br></pre></td></tr></table></figure>
<p> 查看当前分区挂载情况。</p>
<p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">rootfs / rootfs ro,relatime 0 0</span><br><span class="line">tmpfs /dev tmpfs rw,seclabel,nosuid,relatime,mode=755 0 0</span><br><span class="line">devpts /dev/pts devpts rw,seclabel,relatime,mode=600 0 0</span><br><span class="line">proc /proc proc rw,relatime 0 0</span><br><span class="line">sysfs /sys sysfs rw,seclabel,relatime 0 0</span><br><span class="line">selinuxfs /sys/fs/selinux selinuxfs rw,relatime 0 0</span><br><span class="line">debugfs /sys/kernel/debug debugfs rw,relatime 0 0</span><br><span class="line">none /var tmpfs rw,seclabel,relatime,mode=770,gid=1000 0 0</span><br><span class="line">none /acct cgroup rw,relatime,cpuacct 0 0</span><br><span class="line">none /sys/fs/cgroup tmpfs rw,seclabel,relatime,mode=750,gid=1000 0 0</span><br><span class="line">none /sys/fs/cgroup/memory cgroup rw,relatime,memory 0 0</span><br><span class="line">tmpfs /mnt/asec tmpfs rw,seclabel,relatime,mode=755,gid=1000 0 0</span><br><span class="line">tmpfs /mnt/obb tmpfs rw,seclabel,relatime,mode=755,gid=1000 0 0</span><br><span class="line">none /dev/memcg cgroup rw,relatime,memory 0 0</span><br><span class="line">none /dev/cpuctl cgroup rw,relatime,cpu 0 0</span><br><span class="line">none /sys/fs/cgroup tmpfs rw,seclabel,relatime,mode=750,gid=1000 0 0</span><br><span class="line">none /sys/fs/cgroup/memory cgroup rw,relatime,memory 0 0</span><br><span class="line">none /sys/fs/cgroup/freezer cgroup rw,relatime,freezer 0 0</span><br><span class="line">/dev/block/platform/msm_sdcc.1/by-name/system /system ext4 ro,seclabel,relatime,data=ordered 0 0</span><br><span class="line">/dev/block/platform/msm_sdcc.1/by-name/userdata /data ext4 rw,seclabel,nosuid,nodev,relatime,noauto_da_alloc,data=ordered 0 0</span><br><span class="line">/dev/block/platform/msm_sdcc.1/by-name/cache /cache ext4 rw,seclabel,nosuid,nodev,relatime,data=ordered 0 0</span><br><span class="line">/dev/block/platform/msm_sdcc.1/by-name/persist /persist ext4 rw,seclabel,nosuid,nodev,relatime,data=ordered 0 0</span><br><span class="line">/dev/block/platform/msm_sdcc.1/by-name/modem /firmware vfat ro,context=u:object_r:firmware_file:s0,relatime,uid=1000,gid=1000,fmask=0337,dmask=0227,codepage=cp437,iocharset=iso8859-1,shortname=lower,errors=remount-ro 0 0</span><br><span class="line">/dev/fuse /mnt/shell/emulated fuse rw,nosuid,nodev,relatime,user_id=1023,group_id=1023,default_permissions,allow_other 0 0</span><br><span class="line">/dev/fuse /mnt/shell/emulated/0 fuse rw,nosuid,nodev,relatime,user_id=1023,group_id=1023,default_permissions,allow_other 0 0</span><br></pre></td></tr></table></figure>
<p> 找到其中我们关注的带 /system 的那一行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dev/block/platform/msm_sdcc.1/by-name/system /system ext4 ro,seclabel,relatime,data=ordered 0 0</span><br></pre></td></tr></table></figure>
<h3 id="重新挂载。"><a href="#重新挂载。" class="headerlink" title="重新挂载。"></a>重新挂载。</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o remount,rw -t yaffs2 /dev/block/platform/msm_sdcc.1/by-name/system /system</span><br></pre></td></tr></table></figure>
<p> 这里的 /dev/block/platform/msm_sdcc.1/by-name/system 就是我们从上一步的输出里得到的文件路径。</p>
<p> 如果输出没有提示错误的话，操作就成功了，可以对 /system 下的文件为所欲为了。</p>
<h3 id="查看连接过的-WiFi-密码"><a href="#查看连接过的-WiFi-密码" class="headerlink" title="查看连接过的 WiFi 密码"></a>查看连接过的 WiFi 密码</h3><p> <em>注：需要 root 权限。</em></p>
<p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">cat /data/misc/wifi/*.conf</span><br></pre></td></tr></table></figure>
<p> 输出示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">network=&#123;</span><br><span class="line">    ssid=&quot;TP-LINK_9DFC&quot;</span><br><span class="line">    scan_ssid=1</span><br><span class="line">    psk=&quot;123456789&quot;</span><br><span class="line">    key_mgmt=WPA-PSK</span><br><span class="line">    group=CCMP TKIP</span><br><span class="line">    auth_alg=OPEN</span><br><span class="line">    sim_num=1</span><br><span class="line">    priority=13893</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">    ssid=&quot;TP-LINK_F11E&quot;</span><br><span class="line">    psk=&quot;987654321&quot;</span><br><span class="line">    key_mgmt=WPA-PSK</span><br><span class="line">    sim_num=1</span><br><span class="line">    priority=17293</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> ssid 即为我们在 WLAN 设置里看到的名称，psk 为密码，key_mgmt 为安全加密方式。</p>
<h3 id="设置系统日期和时间"><a href="#设置系统日期和时间" class="headerlink" title="设置系统日期和时间"></a>设置系统日期和时间</h3><p> <em>注：需要 root 权限。</em></p>
<p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">date -s 20160823.131500</span><br></pre></td></tr></table></figure>
<p> 表示将系统日期和时间更改为 2016 年 08 月 23 日 13 点 15 分 00 秒。</p>
<h3 id="重启手机"><a href="#重启手机" class="headerlink" title="重启手机"></a>重启手机</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb reboot</span><br></pre></td></tr></table></figure>
<h3 id="检测设备是否已-root"><a href="#检测设备是否已-root" class="headerlink" title="检测设备是否已 root"></a>检测设备是否已 root</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">su</span><br></pre></td></tr></table></figure>
<p> 此时命令行提示符是 $ 则表示没有 root 权限，是 # 则表示已 root。</p>
<h3 id="使用-Monkey-进行压力测试"><a href="#使用-Monkey-进行压力测试" class="headerlink" title="使用 Monkey 进行压力测试"></a>使用 Monkey 进行压力测试</h3><p> Monkey 可以生成伪随机用户事件来模拟单击、触摸、手势等操作，可以对正在开发中的程序进行随机压力测试。</p>
<p> 简单用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell monkey -p &lt;packagename&gt; -v 500</span><br></pre></td></tr></table></figure>
<p> 表示向  <code>&lt;packagename&gt;</code>  指定的应用程序发送 500 个伪随机事件。</p>
<p> Monkey 的详细用法参考 官方文档。</p>
<h3 id="开启-关闭-WiFi"><a href="#开启-关闭-WiFi" class="headerlink" title="开启/关闭 WiFi"></a>开启/关闭 WiFi</h3><p> 注：需要 root 权限。</p>
<p> 有时需要控制设备的 WiFi 状态，可以用以下指令完成。</p>
<p> 开启 WiFi：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb root</span><br><span class="line">adb shell svc wifi enable</span><br></pre></td></tr></table></figure>
<p> 关闭 WiFi：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb root</span><br><span class="line">adb shell svc wifi disable</span><br></pre></td></tr></table></figure>
<p> 若执行成功，输出为空；若未取得 root 权限执行此命令，将执行失败，输出 Killed。</p>
<h2 id="刷机相关命令"><a href="#刷机相关命令" class="headerlink" title="刷机相关命令"></a>刷机相关命令</h2><h3 id="重启到-Recovery-模式"><a href="#重启到-Recovery-模式" class="headerlink" title="重启到 Recovery 模式"></a>重启到 Recovery 模式</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb reboot recovery</span><br></pre></td></tr></table></figure>
<h3 id="从-Recovery-重启到-Android"><a href="#从-Recovery-重启到-Android" class="headerlink" title="从 Recovery 重启到 Android"></a>从 Recovery 重启到 Android</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb reboot</span><br></pre></td></tr></table></figure>
<h3 id="重启到-Fastboot-模式"><a href="#重启到-Fastboot-模式" class="headerlink" title="重启到 Fastboot 模式"></a>重启到 Fastboot 模式</h3><p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb reboot bootloader</span><br></pre></td></tr></table></figure>
<h3 id="通过-sideload-更新系统"><a href="#通过-sideload-更新系统" class="headerlink" title="通过 sideload 更新系统"></a>通过 sideload 更新系统</h3><p> 如果我们下载了 Android 设备对应的系统更新包到电脑上，那么也可以通过 adb 来完成更新。</p>
<p> 以 Recovery 模式下更新为例：</p>
<p> 重启到 Recovery 模式。</p>
<p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb reboot recovery</span><br></pre></td></tr></table></figure>
<p> 在设备的 Recovery 界面上操作进入 Apply update-Apply from ADB。</p>
<p> <em>注：不同的 Recovery 菜单可能与此有差异，有的是一级菜单就有 Apply update from ADB。</em></p>
<p> <strong>通过 adb 上传和更新系统。</strong></p>
<p> 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb sideload &lt;path-to-update.zip&gt;</span><br></pre></td></tr></table></figure>
<h3 id="更多-adb-shell-命令"><a href="#更多-adb-shell-命令" class="headerlink" title="更多 adb shell 命令"></a>更多 adb shell 命令</h3><p> Android 系统是基于 Linux 内核的，所以 Linux 里的很多命令在 Android 里也有相同或类似的实现，在 adb shell 里可以调用。本文档前面的部分内容已经用到了 adb shell 命令。</p>
<h3 id="查看进程"><a href="#查看进程" class="headerlink" title="查看进程"></a>查看进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell ps</span><br></pre></td></tr></table></figure>
<p> 例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USER     PID   PPID  VSIZE  RSS     WCHAN    PC        NAME</span><br><span class="line">root      1     0     8904   788   ffffffff 00000000 S /init</span><br><span class="line">root      2     0     0      0     ffffffff 00000000 S kthreadd</span><br><span class="line">...</span><br><span class="line">u0_a71    7779  5926  1538748 48896 ffffffff 00000000 S com.sohu.inputmethod.sogou:classic</span><br><span class="line">u0_a58    7963  5926  1561916 59568 ffffffff 00000000 S org.mazhuang.boottimemeasure</span><br><span class="line">...</span><br><span class="line">shell     8750  217   10640  740   00000000 b6f28340 R ps</span><br></pre></td></tr></table></figure>
<p> 各列含义：</p>
<pre><code>列名   | 含义    
---- | ------
USER | 所属用户  
PID  | 进程 ID
PPID | 父进程 ID
NAME | 进程名   
</code></pre><h3 id="查看实时资源占用情况"><a href="#查看实时资源占用情况" class="headerlink" title="查看实时资源占用情况"></a>查看实时资源占用情况</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell top</span><br></pre></td></tr></table></figure>
<p> 例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">User 0%, System 6%, IOW 0%, IRQ 0%</span><br><span class="line">User 3 + Nice 0 + Sys 21 + Idle 280 + IOW 0 + IRQ 0 + SIRQ 3 = 307</span><br><span class="line"></span><br><span class="line">  PID PR CPU% S  #THR     VSS     RSS PCY UID      Name</span><br><span class="line"> 8763  0   3% R     1  10640K   1064K  fg shell    top</span><br><span class="line">  131  0   3% S     1      0K      0K  fg root     dhd_dpc</span><br><span class="line"> 6144  0   0% S   115 1682004K 115916K  fg system   system_server</span><br><span class="line">  132  0   0% S     1      0K      0K  fg root     dhd_rxf</span><br><span class="line"> 1731  0   0% S     6  20288K    788K  fg root     /system/bin/mpdecision</span><br><span class="line">  217  0   0% S     6  18008K    356K  fg shell    /sbin/adbd</span><br><span class="line"> ...</span><br><span class="line"> 7779  2   0% S    19 1538748K  48896K  bg u0_a71   com.sohu.inputmethod.sogou:classic</span><br><span class="line"> 7963  0   0% S    18 1561916K  59568K  fg u0_a58   org.mazhuang.boottimemeasure</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>
<p> 各列含义：</p>
<pre><code>列名   | 含义                                    
---- | --------------------------------------
PID  | 进程 ID                                 
PR   | 优先级                                   
CPU% | 当前瞬间占用 CPU 百分比                        
S    | 进程状态（R=运行，S=睡眠，T=跟踪/停止，Z=僵尸进程）        
#THR | 线程数                                   
VSS  | Virtual Set Size 虚拟耗用内存（包含共享库占用的内存）   
RSS  | Resident Set Size 实际使用物理内存（包含共享库占用的内存）
PCY  | 调度策略优先级，SP_BACKGROUND/SPFOREGROUND    
UID  | 进程所有者的用户 ID                           
NAME | 进程名                                   
</code></pre><p> top 命令还支持一些命令行参数，详细用法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Usage: top [ -m max_procs ] [ -n iterations ] [ -d delay ] [ -s sort_column ] [ -t ] [ -h ]</span><br><span class="line">    -m num  最多显示多少个进程</span><br><span class="line">    -n num  刷新多少次后退出</span><br><span class="line">    -d num  刷新时间间隔（单位秒，默认值 5）</span><br><span class="line">    -s col  按某列排序（可用 col 值：cpu, vss, rss, thr）</span><br><span class="line">    -t      显示线程信息</span><br><span class="line">    -h      显示帮助文档</span><br></pre></td></tr></table></figure>
<h3 id="查看进程-UID"><a href="#查看进程-UID" class="headerlink" title="查看进程 UID"></a>查看进程 UID</h3><p> 有两种方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys package &lt;packagename&gt; | grep userId=</span><br></pre></td></tr></table></figure>
<p> 如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell dumpsys package org.mazhuang.guanggoo | grep userId=</span><br><span class="line">   userId=10394</span><br></pre></td></tr></table></figure>
<p> 通过 ps 命令找到对应进程的 pid 之后  <code>adb shell cat /proc/&lt;pid&gt;/status | grep Uid</code></p>
<p> 如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell</span><br><span class="line">gemini:/ $ ps | grep org.mazhuang.guanggoo</span><br><span class="line">u0_a394   28635 770   1795812 78736 SyS_epoll_ 0000000000 S org.mazhuang.guanggoo</span><br><span class="line">gemini:/ $ cat /proc/28635/status | grep Uid</span><br><span class="line">Uid:    10394   10394   10394   10394</span><br><span class="line">gemini:/ $</span><br></pre></td></tr></table></figure>
<h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><p> 如下是其它常用命令的简单描述，前文已经专门讲过的命令不再额外说明：</p>
<pre><code>命令    | 功能            
----- | --------------
cat   | 显示文件内容        
cd    | 切换目录          
chmod | 改变文件的存取模式/访问权限
df    | 查看磁盘空间使用情况    
grep  | 过滤输出          
kill  | 杀死指定 PID 的进程  
ls    | 列举目录内容        
mount | 挂载目录的查看和管理    
mv    | 移动或重命名文件      
ps    | 查看正在运行的进程     
rm    | 删除文件          
top   | 查看进程的资源占用情况   
</code></pre><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="启动-adb-server-失败"><a href="#启动-adb-server-失败" class="headerlink" title="启动 adb server 失败"></a>启动 adb server 失败</h3><p> 出错提示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: protocol fault (couldn&apos;t read status): No error</span><br></pre></td></tr></table></figure>
<p> 可能原因</p>
<p> adb server 进程想使用的 5037 端口被占用。</p>
<p> 解决方案</p>
<p> 找到占用 5037 端口的进程，然后终止它。以 Windows 下为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano | findstr LISTENING</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">TCP    0.0.0.0:5037           0.0.0.0:0              LISTENING       1548</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p> 这里 1548 即为进程 ID，用命令结束该进程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskkill /PID 1548</span><br></pre></td></tr></table></figure>
<p> 然后再启动 adb 就没问题了。</p>

          
        
      
    </div>
    
    
    



    

    

    


    <footer class="post-footer">
      

      

      

      <div>
        
      </div>

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/2018/12/25/dex学习和探究/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Horace Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/12/25/dex学习和探究/" itemprop="url">dex学习和探究</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-25T19:21:08+08:00">
                2018-12-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,769
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="dex学习和探究"><a href="#dex学习和探究" class="headerlink" title="dex学习和探究"></a>dex学习和探究</h3><p><strong>一．    Dex是什么</strong></p>
<p>Dex (Dalvik Executable Format)是java中存储类定义和相关联数据的一种数据格式，主要用于保存类定义及其关联的辅助数据</p>
<p>.dex结构分成三部分:<br><strong>文件头</strong>:表明了是dex文件，已经文件的大小等等数据<br><strong>索引头</strong>:如下图所示<br><strong>数据区</strong>：数据区,就像是jvm中的堆保存方法+变量。</p>
<p>下面是dex的数据格式：<br><img src="/blog/2018/12/25/dex学习和探究/data.jpg" alt="数据格式"></p>
<blockquote>
<p><strong>odex简介</strong><br>odex是OptimizedDEX的缩写,表示对dex的优化。系统预置应用经常会采用odex的方式加载，一般存放在/data/dalvik-cache目录下。</p>
<p>由于Android程序的apk文件为zip压缩包格式，Dalvik虚拟机每次加载它们时需要从apk中读取classes.dex文件，这样会耗费很多cpu时间，而采用odex方式优化的dex文件，已经包含了加载dex必须的依赖库文件列表，Dalvik虚拟机只需检测并加载所需的依赖库即可执行相应的dex文件，这大大缩短了读取dex文件所需的时间。</p>
<p>不过，这个优化过程会根据不同设备上Dalvik虚拟机的版本、Framework库的不同等因素而不同。在一台设备上被优化过的ODEX文件，拷贝到另一台设备上不一定能够运行。</p>
</blockquote>
<p><strong>二．    Dex的加载流程</strong></p>
<p>&emsp;&emsp; Android提供了一个专门验证与优化dex文件的工具dexopt。其源码位于Android系统源码的dalvik/dexopt目录下，Dalvik虚拟机在加载一个dex文件时，通过指定的验证与优化选项来调用dexopt进行相应的验证与优化操作。<a href="https://blog.csdn.net/jltxgcy/article/details/50552674" target="_blank" rel="noopener">具体加载流程参考</a></p>
<p><img src="/blog/2018/12/25/dex学习和探究/verify.jpg" alt="加载验证"></p>
<p>&emsp;&emsp; 简要总结下整个的加载流程，首先是对文件名的修正，后缀名置为”.dex”作为输出文件，然后生个一个DexPathList对象函数直接返回一个DexPathList对象，</p>
<p>&emsp;&emsp; 在DexPathList的构造函数中调用makeDexElements()函数，在makeDexElement()函数中调用loadDexFile()开始对.dex或者是.jar .zip .apk文件进行处理，跟入loadDexFile()函数中，会发现里面做的工作很简单，调用optimizedPathFor()函数对optimizedDiretcory路径进行修正。</p>
<p><img src="/blog/2018/12/25/dex学习和探究/load1.jpg" alt="加载验证"><br>&emsp;&emsp; 之后才真正通过DexFile.loadDex()开始加载文件中的数据，其中的加载也只是返回一个DexFile对象。</p>
<p>&emsp;&emsp; 在DexFile类的构造函数中，重点便放在了其调用的openDexFile()函数，在openDexFile()中调用了openDexFileNative()真正进入native层，在openDexFileNative()的真正实现中，对于后缀名为.dex的文件或者其他文件(.jar .apk .zip)分开进行处理：</p>
<p>&emsp;&emsp; .dex文件调用dvmRawDexFileOpen()；<br>&emsp;&emsp; 其他文件调用dvmJarFileOpen()。</p>
<p><img src="/blog/2018/12/25/dex学习和探究/load2.jpg" alt="加载dex"></p>
<p>&emsp;&emsp; 在dvmRawDexFileOpen()函数中，检验dex文件的标志，检验odex文件的缓存名称，之后将dex文件拷贝到odex文件中，并对odex进行优化。</p>
<p>&emsp;&emsp; 调用dvmDexFileOpenFromFd()对优化后的odex文件进行映射，通过mprotect置为”只读”属性并将映射的内存结构保存在DvmDex*结构中。</p>
<p>&emsp;&emsp; dvmJarFileOpen()先对文件进行映射，结构保存在ZipArchive中，然后再尝试以文件名作为dex文件名来“打开”文件，如果失败，则调用dexZipFindEntry在ZipArchive的名称hash表中找名为”class.dex”的文件,然后创建odex文件，下面就和dvmRawDexFileOpen()一样了，就是对dex文件进行优化和映射。</p>
<p>最关键的loadDexFile和optimizedPathFor方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">private static DexFile loadDexFile(File file, File optimizedDirectory)</span><br><span class="line">            throws IOException &#123;</span><br><span class="line">        if (optimizedDirectory == null) &#123;</span><br><span class="line">            return new DexFile(file);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            String optimizedPath = optimizedPathFor(file, optimizedDirectory);</span><br><span class="line">            return DexFile.loadDex(file.getPath(), optimizedPath, 0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//生成odex的目录</span><br><span class="line">private static String optimizedPathFor(File path,</span><br><span class="line">            File optimizedDirectory) &#123;</span><br><span class="line">        String fileName = path.getName();</span><br><span class="line">        if (!fileName.endsWith(DEX_SUFFIX)) &#123;</span><br><span class="line">            int lastDot = fileName.lastIndexOf(&quot;.&quot;);</span><br><span class="line">            if (lastDot &lt; 0) &#123;</span><br><span class="line">                fileName += DEX_SUFFIX;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                StringBuilder sb = new StringBuilder(lastDot + 4);</span><br><span class="line">                sb.append(fileName, 0, lastDot);</span><br><span class="line">                sb.append(DEX_SUFFIX);</span><br><span class="line">                fileName = sb.toString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        File result = new File(optimizedDirectory, fileName);</span><br><span class="line">        return result.getPath();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp; optimizedPathFor 方法：就是将dex 优化形成optimizedDex文件。然后<br>通过DexFile的静态方法将.dex文件。或者apk，.jar加载成DexFile文件。DexFile 是C语言中的结构体，里面保存的都是一些指针。经过不断的校检，最后通过dvm里面的c代码处理，得到DexFile。</p>
<p><strong>三．    Dex的应用场景</strong><br>&emsp;&emsp;  结合dex的支持动态加载的特性，dex通常被用于以下场合：</p>
<ol>
<li><p><strong>MultiDex分包</strong>： 拆分dex，可以解决方法数超过65535导致的编译问题。也支持分包后再Application的onCreate()方法中调用 <strong>MultiDex.install(this)</strong>来加载不同的dex包。</p>
<blockquote>
<p>可以用于解决2.3上无法安装问题<br> INSTALL_FAILED_DEXOPT</p>
</blockquote>
<blockquote>
<p>可以解决方法数过多问题：<br> Conversion to Dalvik format failed:Unable to execute dex: method ID not in [0, 0xffff]: 65536</p>
</blockquote>
</li>
<li><p><strong>应用热更新</strong>： 参考腾讯的<a href="https://github.com/Tencent/tinker" target="_blank" rel="noopener">tinker</a>方案。tinker的核心思想是利用DexDiff算法对比差异生成Patch补丁包，全量合成新Dex进行整体替换。这里面就涉及到dex的具体加载过程中，很重要的一个特点，在DexPathList加载类时，会遍历dexElements数组，ClassLoader在加载到正确的类之后就会停止加载此类，基于这个原理，可以用来做应用的局部热更新。tinker是在这个基础上增加了差量包的定义，引入了自定义的 <a href="https://www.jianshu.com/p/af784b20cee5" target="_blank" rel="noopener">dexdiff算法</a>。</p>
</li>
<li><p><strong>插件化</strong>：动态加载模块，参见于广点通sdk方案。将包含dex的jar放到asset目录下，动态加载函数类，而不用安装独立的应用。该方案可以用于广告sdk，应用插件等开发，采用动态加载dex，通常会将dex文件下载放置于data目录而不是sd卡目录（sd卡不安全），并且采用加密算法进行dex的内部加密，支持动态下载更新dex文件，提升了代码破解难度，增加了apk的运维可能。</p>
<p><img src="/blog/2018/12/25/dex学习和探究/gdt.png" alt="广点通动态加载"></p>
</li>
</ol>
<ol start="4">
<li><strong>应用加固和脱壳</strong>： 这方面没有过多涉猎，有空可以学习下<a href="https://blog.csdn.net/mergerly/article/details/62045535" target="_blank" rel="noopener">mergerly整理的加固脱壳方法</a></li>
</ol>
<p><strong>四．    Dex方案的优劣</strong></p>
<p>&emsp;&emsp;可能带来的问题：</p>
<ol>
<li><p>MultiDex分包可能增加进入耗时，dex文件不能过大，否则容易在进入加载dex时出现anr或异常。</p>
</li>
<li><p>可能引入一些加载异常：</p>
<blockquote>
<p>ClassNotFoundException: Didn’t find class “com.squareup.picasso.Picasso” on path: DexPathList[[zip file “/data/app/com.groupon.dexlazyload-1/base.apk”]</p>
</blockquote>
</li>
<li><p>增加了<a href="https://www.cnblogs.com/goodhacker/p/5152952.html" target="_blank" rel="noopener">代码注入和应用劫持的风险</a></p>
</li>
</ol>
<p>&emsp;&emsp;优点：</p>
<ol>
<li><p>支持热更新和热修复，避免整体apk更新带来的流量问题和迭代问题。</p>
</li>
<li><p>支持dex加固，一定程度上增加了apk被反编译破解带来的风险。</p>
</li>
<li><p>允许动态加载指定的dex内的函数。</p>
</li>
</ol>
<p><strong>五．    tqy dex加载分析</strong><br>&emsp;&emsp; tqy sdk的初始化中会调用initSdk，</p>
<p>&emsp;&emsp;校验文件：<br>  <img src="/blog/2018/12/25/dex学习和探究/tqy-1.png" alt="tqy加载"></p>
<p>  &emsp;&emsp;加载dex<br>  <img src="/blog/2018/12/25/dex学习和探究/tqy-2.png" alt="tqy加载"></p>
<p>  具体的dex文件被放置到： /data/user/0/com.tqy.sdk.ad/ 目录上：<br>  <img src="/blog/2018/12/25/dex学习和探究/tqy-3.png" alt="tqy加载"></p>
<p>  在通过dex文件的md5校验，之后加载类实例，覆盖原有的register方法，jar包中清晰可见在原有的基础上增加了adServiceLogic的实现。</p>
<p>  <img src="/blog/2018/12/25/dex学习和探究/tqy-4.png" alt="tqy加载"></p>
<p>  也意味着原有的方法只提供了基础的方法名称，在dex中才是方法的真正实现。</p>

          
        
      
    </div>
    
    
    



    

    

    


    <footer class="post-footer">
      

      

      

      <div>
        
      </div>

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/2018/12/14/UE16禁止显示切换/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Horace Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/12/14/UE16禁止显示切换/" itemprop="url">UE16禁止显示切换</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-14T11:49:12+08:00">
                2018-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  94
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1) 按 ctrl+N ,新建一个文件<br>2) 输入一个空格<br>3）按ctrl + H,切换到十六进制查看模式，这是显示的是：<br>0000000h:20<br>4) 修改第一个 20为34，然后接着输入 44 45 44 45 44 46 34<br>5) 按ctrl + H,切换到普通查看模式，就可以看到字符显示<br>34 44 45 44 45 44 46 34 对应 4DEDEDF4</p>

          
        
      
    </div>
    
    
    



    

    

    


    <footer class="post-footer">
      

      

      

      <div>
        
      </div>

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/2018/08/24/通过ttl-判断经过多少路由/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Horace Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/08/24/通过ttl-判断经过多少路由/" itemprop="url">通过ttl 判断经过多少路由</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-24T19:30:35+08:00">
                2018-08-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  788
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>当我们访问某个网络时，通过tracert命令，就能知道本机与目标主机之间经过多台主机，</p>
<p>即经过多少路由。</p>
<hr>
<p>eg:</p>
<p>C:\Users\acer&gt;tracert <a href="http://www.datang.com" target="_blank" rel="noopener">www.datang.com</a></p>
<p>通过最多 30 个跃点跟踪<br>到 <a href="http://www.datang.com" target="_blank" rel="noopener">www.datang.com</a> [219.141.223.5] 的路由:</p>
<p>  1     1 ms    &lt;1 毫秒   &lt;1 毫秒 221.206.0.220<br>  2     2 ms     1 ms     1 ms  221.206.1.41<br>  3     9 ms     6 ms     8 ms  60.14.244.45<br>  4    25 ms    27 ms    27 ms  219.158.19.41<br>  5    29 ms    27 ms    25 ms  219.158.101.114<br>  6     <em>        </em>        <em>     请求超时。<br>  7     </em>        <em>        </em>     请求超时。<br>  8     <em>        </em>        *     请求超时。<br>  9   133 ms   130 ms   129 ms  bj141-133-246.bjtelecom.net [219.141.133.246]<br> 10   131 ms   130 ms   131 ms  bj141-162-194.bjtelecom.net [219.141.162.194]<br> 11   141 ms   145 ms   131 ms  74.23.142.219.broad.bj.bj.dynamic.163data.com.cn<br> [219.142.23.74]<br> 12   140 ms   133 ms   132 ms  bj141-223-5.bjtelecom.net [219.141.223.5]</p>
<p>跟踪完成。</p>
<hr>
<p>我们访问<a href="http://www.datang.com主机（当然这里可以是IP地址），经过12次路由之后，就到达目标主机了。" target="_blank" rel="noopener">www.datang.com主机（当然这里可以是IP地址），经过12次路由之后，就到达目标主机了。</a></p>
<p>我们可以用ping命令来进行验证！eg:</p>
<p>C:\Users\acer&gt;ping <a href="http://www.datang.com" target="_blank" rel="noopener">www.datang.com</a> -i 11</p>
<p>正在 Ping <a href="http://www.datang.com" target="_blank" rel="noopener">www.datang.com</a> [219.141.223.5] 具有 32 字节的数据:<br>来自 219.142.23.74 的回复: TTL 传输中过期。<br>来自 219.142.23.74 的回复: TTL 传输中过期。<br>来自 219.142.23.74 的回复: TTL 传输中过期。<br>来自 219.142.23.74 的回复: TTL 传输中过期。</p>
<p>219.141.223.5 的 Ping 统计信息:<br>    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，</p>
<p>C:\Users\acer&gt;ping <a href="http://www.datang.com" target="_blank" rel="noopener">www.datang.com</a> -i 12</p>
<p>正在 Ping <a href="http://www.datang.com" target="_blank" rel="noopener">www.datang.com</a> [219.141.223.5] 具有 32 字节的数据:<br>来自 219.141.223.5 的回复: 字节=32 时间=131ms TTL=118<br>来自 219.141.223.5 的回复: 字节=32 时间=132ms TTL=118<br>来自 219.141.223.5 的回复: 字节=32 时间=131ms TTL=118<br>来自 219.141.223.5 的回复: 字节=32 时间=131ms TTL=118</p>
<p>219.141.223.5 的 Ping 统计信息:<br>    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，<br>往返行程的估计时间(以毫秒为单位):<br>    最短 = 131ms，最长 = 132ms，平均 = 131ms</p>
<p>注：</p>
<p>ping 命令的-i参数用于设置发出数据包的“生存时间”。<br>若设为n，则该数据包经过n个结点即停止传送。若两个地址之间实际节点数大于n(即包未送至目的地)，<br>则会显示【TTL expired in transit】(传送时过期)。tracert命令即此原理，分别发送i=1,2,3……,30(默认30)的包实现。</p>
<p>在上面，当我们设置“生存时间”为 11 时，数据包无法正常到达目标主机，</p>
<p>而设置为 12 时，就能正常到达，</p>
<p>通过 tracert 命令，可以看到到达目的主机时，最后一个IP为 219.141.223.5，</p>
<p>而通过ping 命令，也会看到是由219.141.223.5返回的数据，说明对应上了，即目的主机IP即为219.141.223.5，</p>
<p>这里也刚好验证了，数据包要经过12次路由才能到达目标主机！</p>
<p>那么默认主机的TTL值应该为118+12=130 （这个值可以由公司来改，不一定就是默认值）</p>

          
        
      
    </div>
    
    
    



    

    

    


    <footer class="post-footer">
      

      

      

      <div>
        
      </div>

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/2018/08/20/查看应用packagename和activity的几种方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Horace Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/08/20/查看应用packagename和activity的几种方法/" itemprop="url">查看应用packagename和activity的几种方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-20T20:30:43+08:00">
                2018-08-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  347
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>下载android SDK并配好环境变量时，可以通过多种方式获取当前activity名称：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aapt dump badging [yourapp.apk]</span><br></pre></td></tr></table></figure>
<p>如果只是想查看手机上应用的packageName，则输入命令：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell pm list packages</span><br></pre></td></tr></table></figure></p>
<p>列出如下信息：</p>
<p>package:android</p>
<p>package:cn.ninegame.gamemanager</p>
<p>package:com.alipay.android.app</p>
<p>如果想知道应用对应的apk文件在手机上的安装位置则可以在上面的命令后加-f参数</p>
<p>adb shell pm list packages -f</p>
<p>查看Android应用包名、Activity的几个方法</p>
<p>一、有源码情况</p>
<p>直接打开AndroidManifest.xml文件，找到包含Android.intent.action.MAIN和android.intent.category.LAUNCHER对应的activity。</p>
<p>如下图中第三行package为com.cola.ui，第七行主Activity为com.cola.ui.ColaBox(.ColaBox为Activity简写方式)。</p>
<p>[html] view plain copy<br>&lt;?xml version=”1.0” encoding=”utf-8”?&gt;  </p>
<manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.cola.ui" android:versioncode="1" android:versionname="1.0.0"><br>    <application android:icon="@drawable/icon" android:label="@string/app_name"><br>        <activity android:name=".ColaBox" android:label="@string/app_name"><br>            <intent-filter><br>                <action android:name="android.intent.action.MAIN"><br>                <category android:name="android.intent.category.LAUNCHER"><br>            </category></action></intent-filter><br>        </activity><br>    <activity android:name="Frm_Addbills"></activity><br>    <activity android:name="Frm_Editacctitem"></activity><br>    <activity android:name="Grid_bills"></activity><br>    <service android:name="LocalService" android:exported="true" android:enabled="true"><br><br>   </service></application><br> <uses-permission android:name="android.permission.READ_CONTACTS"><br><br><br></uses-permission></manifest>   

<p>二、只有Apk的情况</p>
<p>（1）aapt</p>
<p>使用命令行aapt dump xmltree ColaBox.apk AndroidManifest.xml</p>
<p>（2）使用apktool</p>
<p>使用反编译工具apktool，反编译后打开AndroidManifest.xml文件，查找方式同“有源码情况”</p>
<p>（3）aapt</p>
<p>感谢“天地会珠海分舵”地址：<a href="http://blog.csdn.net/zhubaitian/article/details/38926679" target="_blank" rel="noopener">http://blog.csdn.net/zhubaitian/article/details/38926679</a></p>
<p>三、没有apk，应用已经安装到手机或虚拟机中</p>
<p>1.logcat</p>
<p>.清除logcat内容，使用命令adb logcat -c</p>
<p>.启动logcat，使用命令adb logcat ActivityManager:I *:s</p>
<p>.启动要查看的程序，</p>
<p>2.dumpsys</p>
<p>（1）启动要查看的程序；</p>
<p>（2）命令行输入：adb shell dumpsys window w |findstr \/ |findstr name=</p>

          
        
      
    </div>
    
    
    



    

    

    


    <footer class="post-footer">
      

      

      

      <div>
        
      </div>

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/2018/08/16/TEST-ONLY-导致apk无法安装问题解决/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Horace Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/08/16/TEST-ONLY-导致apk无法安装问题解决/" itemprop="url">TEST_ONLY 导致apk无法安装问题解决</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-16T13:50:55+08:00">
                2018-08-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  664
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>升级到7.0，android studio升级到3.0后经常出下如下异常，导致apk无法正常安装，放到手机sd卡中也无法完成安装，会提示安装失败：</p>
<p><img src="/blog/2018/08/16/TEST-ONLY-导致apk无法安装问题解决/adb.png" alt="adb命令行"></p>
<p>通过如下命令可以完成安装：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb install -t *.APK</span><br></pre></td></tr></table></figure></p>
<h3 id="但是导致问题的原因在哪里呢？"><a href="#但是导致问题的原因在哪里呢？" class="headerlink" title="但是导致问题的原因在哪里呢？"></a>但是导致问题的原因在哪里呢？</h3><p>网上有说是manifest中配置了testOnly标签的：</p>
<p><img src="/blog/2018/08/16/TEST-ONLY-导致apk无法安装问题解决/testOnly.png" alt="网络上问题原因"></p>
<p>然而实际上，真正的原因是什么呢？<br>看看官方的说明吧：<br><a href="https://developer.android.com/studio/run/index.html" target="_blank" rel="noopener">https://developer.android.com/studio/run/index.html</a></p>
<blockquote>
<p>Note: The Run button builds an APK with testOnly=”true”, which means the APK can only be installed via adb (which Android Studio uses). If you want a debuggable APK that people can install without adb, select your debug variant and click Build &gt; Build APK(s).</p>
</blockquote>
<p><strong>大致意思就是说，只要在AndroidStudio3.0内，点击运行Run，跑出来的apk，一定是TEST_ONLY的，如果需要可以安装的apk，直接使用build apks或者assembleRelease即可。</strong></p>
<hr>
<p>以下转载自 <a href="http://blog.sina.com.cn/s/blog_6cbd24890102x0ki.html" target="_blank" rel="noopener">沈文昌同学的blog</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">之前有个问题涉及到生成apk无法安装。当时搜索到的结果是和gradle版本有关，实际上不是这样的。</span><br><span class="line"></span><br><span class="line">今天测试妹妹要一个apk，我直接run了一个给她，发现问题又出现了。</span><br><span class="line"></span><br><span class="line">我首先怀疑是不是Instant Run的配置，但这个配置我在settings里是关掉的，而Run功能（绿三角）的Configurations里，Android App-&gt;app中，右侧最下方Before launch，配置了一个Instant App Provision。我将这个配置直接删掉，问题依旧。</span><br><span class="line"></span><br><span class="line">看来不是Instant Run的锅。</span><br><span class="line"></span><br><span class="line">然后，开始怀疑是否是gradle版本不可为最新，尝试下载了升级AS3.0默认配的4.0-milestone-1，以及4.1，以及4.1-milestone-1，花费了很多时间，最后发现也不是gradle版本问题。</span><br><span class="line"></span><br><span class="line">最终，在一个曾经看过的帖子上，发现了另一个回答。</span><br><span class="line"></span><br><span class="line">https://stackoverflow.com/questions/25274296/adb-install-fails-with-install-failed-test-only</span><br><span class="line"></span><br><span class="line">往下翻，有个只有个位数支持率的回答，里面提到官方网站在beta7版本已经有了提示： https://developer.android.com/studio/run/index.html</span><br><span class="line"></span><br><span class="line">这个网站我是打不开的……好吧，这位好心人直接把主要内容粘贴了：</span><br><span class="line"></span><br><span class="line">Note: The Run button builds an APK with testOnly=&quot;true&quot;, which means the APK can only be installed via adb (which Android Studio uses). If you want a debuggable APK that people can install without adb, select your debug variant and click Build &gt; Build APK(s).</span><br><span class="line"></span><br><span class="line">也就是说，只要在AndroidStudio3.0内，点击绿三角运行Run，跑出来的apk，一定是TEST_ONLY的。</span><br><span class="line"></span><br><span class="line">问题解决，以后给测试妹妹出apk，不能直接用Run出来的了，必须跑一下Build Apks。</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    



    

    

    


    <footer class="post-footer">
      

      

      

      <div>
        
      </div>

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/2018/07/26/markdown-语法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Horace Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/07/26/markdown-语法/" itemprop="url">markdown 语法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-26T21:04:08+08:00">
                2018-07-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/markdown/" itemprop="url" rel="index">
                    <span itemprop="name">markdown</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  5,779
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  23
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Markdown-文件"><a href="#Markdown-文件" class="headerlink" title="Markdown 文件"></a>Markdown 文件</h1><p><img src="https://markdown.tw/images/208x128.png" alt="Markdown"></p>
<p><strong>NOTE:</strong> This is Traditional Chinese Edition Document of<br>Markdown Syntax. If you are seeking for English Edition<br>Document. Please refer to <a href="http://daringfireball.net/projects/markdown/syntax" target="_blank" rel="noopener">Markdown: Syntax</a>.</p>
<h1 id="Markdown-Syntax"><a href="#Markdown-Syntax" class="headerlink" title="Markdown: Syntax"></a>Markdown: Syntax</h1><ul>
<li><a href="#overview">概述</a><ul>
<li><a href="#philosophy">哲学</a></li>
<li><a href="#html">行内 HTML</a></li>
<li><a href="#autoescape">特殊字符自动转换</a></li>
</ul>
</li>
<li><a href="#block">区块元素</a><ul>
<li><a href="#p">段落和换行</a></li>
<li><a href="#header">标题</a></li>
<li><a href="#blockquote">区块引言</a></li>
<li><a href="#list">清单</a></li>
<li><a href="#precode">程序代码区块</a></li>
<li><a href="#hr">分隔线</a></li>
</ul>
</li>
<li><a href="#span">区段元素</a><ul>
<li><a href="#link">连结</a></li>
<li><a href="#em">强调</a></li>
<li><a href="#code">程序代码</a></li>
<li><a href="#img">图片</a></li>
</ul>
</li>
<li><a href="#misc">其它</a><ul>
<li><a href="#backslash">跳脱字符</a></li>
<li><a href="#autolink">自动连结</a></li>
</ul>
</li>
<li><a href="#acknowledgement">感谢</a></li>
</ul>
<p><strong>注意：</strong>这份文件是用 Markdown 写的，你可以<a href="https://github.com/othree/markdown-syntax-zhtw/blob/master/syntax.md" target="_blank" rel="noopener">看看它的原始档</a> 。</p>
<hr>
<h2 id="overview">概述</h2>

<h3 id="philosophy">哲学</h3>

<p>Markdown 的目标是实现「易读易写」。</p>
<p>不过最需要强调的便是它的可读性。一份使用 Markdown 格式撰写的文件应该可以直接以纯文本发布，并且看起来不会像是由许多卷标或是格式指令所构成。Markdown 语法受到一些既有 text-to-HTML 格式的影响，包括 <a href="http://docutils.sourceforge.net/mirror/setext.html" target="_blank" rel="noopener">Setext</a>、<a href="http://www.aaronsw.com/2002/atx/" target="_blank" rel="noopener">atx</a>、<a href="http://textism.com/tools/textile/" target="_blank" rel="noopener">Textile</a>、<a href="http://docutils.sourceforge.net/rst.html" target="_blank" rel="noopener">reStructuredText</a>、<a href="http://www.triptico.com/software/grutatxt.html" target="_blank" rel="noopener">Grutatext</a> 和 <a href="http://ettext.taint.org/doc/" target="_blank" rel="noopener">EtText</a>，然而最大灵感来源其实是纯文本的电子邮件格式。</p>
<p>因此 Markdown 的语法全由标点符号所组成，并经过严谨慎选，是为了让它们看起来就像所要表达的意思。像是在文字两旁加上星号，看起来就像*强调*。Markdown 的列表看起来，嗯，就是清单。假如你有使用过电子邮件，区块引言看起来就真的像是引用一段文字。</p>
<h3 id="html">行内 HTML</h3>

<p>Markdown 的语法有个主要的目的：用来作为一种网络内容的<em>写作</em>用语言。</p>
<p>Markdown 不是要来取代 HTML，甚至也没有要和它相似，它的语法种类不多，只和 HTML 的一部分有关系，重点<em>不是</em>要创造一种更容易写作 HTML 文件的语法，我认为 HTML 已经很容易写了，Markdown 的重点在于，它能让文件更容易阅读、编写。HTML 是一种<em>发布</em>的格式，Markdown 是一种<em>编写</em>的格式，因此，Markdown 的格式语法只涵盖纯文本可以涵盖的范围。</p>
<p>不在 Markdown 涵盖范围之外的标签，都可以直接在文件里面用 HTML 撰写。不需要额外标注这是 HTML 或是 Markdown；只要直接加标签就可以了。</p>
<p>只有区块元素──比如 <code>&lt;div&gt;</code>、<code>&lt;table&gt;</code>、<code>&lt;pre&gt;</code>、<code>&lt;p&gt;</code> 等标签，必须在前后加上空行，以利与内容区隔。而且这些（元素）的开始与结尾标签，不可以用 tab 或是空白来缩排。Markdown 的产生器有智能型判断，可以避免在区块标签前后加上没有必要的 <code>&lt;p&gt;</code> 标签。</p>
<p>举例来说，在 Markdown 文件里加上一段 HTML 表格：</p>
<pre><code>This is a regular paragraph.

&lt;table&gt;
    &lt;tr&gt;
        &lt;td&gt;Foo&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;

This is another regular paragraph.
</code></pre><p>请注意，Markdown 语法在 HTML 区块卷标中将不会被进行处理。例如，你无法在 HTML 区块内使用 Markdown 形式的<code>*强调*</code>。</p>
<p>HTML 的区段标签如 <code>&lt;span&gt;</code>、<code>&lt;cite&gt;</code>、<code>&lt;del&gt;</code> 则不受限制，可以在 Markdown 的段落、清单或是标题里任意使用。依照个人习惯，甚至可以不用Markdown 格式，而采用 HTML 标签来格式化。举例说明：如果比较喜欢 HTML 的  <code>&lt;a&gt;</code> 或 <code>&lt;img&gt;</code> 标签，可以直接使用这些标签，而不用 Markdown 提供的链接或是影像标示语法。</p>
<p>HTML 区段卷标和区块卷标不同，在区段标签的范围内， Markdown 的语法是有效的。</p>
<h3 id="autoescape">特殊字符自动转换</h3>

<p>在 HTML 文件中，有两个字符需要特殊处理： <code>&lt;</code> 和 <code>&amp;</code> 。 <code>&lt;</code> 符号用于起始卷标，<code>&amp;</code> 符号则用于标记 HTML 实体，如果你只是想要使用这些符号，你必须要使用实体的形式，像是 <code>&amp;lt;</code> 和 <code>&amp;amp;</code>。</p>
<p><code>&amp;</code> 符号其实很容易让写作网络文件的人感到困扰，如果你要打「AT&amp;T」 ，你必须要写成「<code>AT&amp;amp;T</code>」 ，还得转换网址内的 <code>&amp;</code> 符号，如果你要链接到：</p>
<pre><code>http://images.google.com/images?num=30&amp;q=larry+bird
</code></pre><p>你必须要把网址转成：</p>
<pre><code>http://images.google.com/images?num=30&amp;amp;q=larry+bird
</code></pre><p>才能放到链接卷标的 <code>href</code> 属性里。不用说也知道这很容易忘记，这也可能是 HTML 标准检查所检查到的错误中，数量最多的。</p>
<p>Markdown 允许你直接使用这些符号，但是你要小心跳脱字符的使用，如果你是在HTML 实体中使用 <code>&amp;</code> 符号的话，它不会被转换，而在其它情形下，它则会被转换成 <code>&amp;amp;</code>。所以你如果要在文件中插入一个著作权的符号，你可以这样写：</p>
<pre><code>&amp;copy;
</code></pre><p>Markdown 将不会对这段文字做修改，但是如果你这样写：</p>
<pre><code>AT&amp;T
</code></pre><p>Markdown 就会将它转为：</p>
<pre><code>AT&amp;amp;T
</code></pre><p>类似的状况也会发生在 <code>&lt;</code> 符号上，因为 Markdown 支持 <a href="#html">行内 HTML</a> ，如果你是使用 <code>&lt;</code> 符号作为 HTML 卷标使用，那 Markdown 也不会对它做任何转换，但是如果你是写：</p>
<pre><code>4 &lt; 5
</code></pre><p>Markdown 将会把它转换为：</p>
<pre><code>4 &amp;lt; 5
</code></pre><p>不过需要注意的是，code 范围内，不论是行内还是区块， <code>&lt;</code> 和 <code>&amp;</code> 两个符号都<em>一定</em>会被转换成 HTML 实体，这项特性让你可以很容易地用 Markdown 写 HTML code （和 HTML 相对而言， HTML 语法中，你要把所有的 <code>&lt;</code> 和 <code>&amp;</code> 都转换为 HTML 实体，才能在 HTML 文件里面写出 HTML code。）</p>
<hr>
<h2 id="block">区块元素</h2>


<h3 id="p">段落和换行</h3>

<p>一个段落是由一个以上相连接的行句组成，而一个以上的空行则会切分出不同的段落（空行的定义是显示上看起来像是空行，便会被视为空行。比方说，若某一行只包含空白和 tab，则该行也会被视为空行），一般的段落不需要用空白或断行缩排。</p>
<p>「一个以上相连接的行句组成」这句话其实暗示了 Markdown 允许段落内的强迫断行，这个特性和其他大部分的 text-to-HTML 格式不一样（包括 MovableType 的「Convert Line Breaks」选项），其它的格式会把每个断行都转成 <code>&lt;br /&gt;</code> 标签。</p>
<p>如果你<em>真的</em>想要插入 <code>&lt;br /&gt;</code> 标签的话，在行尾加上两个以上的空白，然后按 enter。</p>
<p>是的，这确实需要花比较多功夫来插入 <code>&lt;br /&gt;</code> ，但是「每个换行都转换为 <code>&lt;br /&gt;</code>」的方法在 Markdown 中并不适合， Markdown 中 email 式的 <a href="#blockquote">区块引言</a> 和多段落的 <a href="#list">清单</a> 在使用换行来排版的时候，不但更好用，还更好阅读。</p>
<h3 id="header">标题</h3>

<p>Markdown 支持两种标题的语法，<a href="http://docutils.sourceforge.net/mirror/setext.html" target="_blank" rel="noopener">Setext</a> 和 <a href="http://www.aaronsw.com/2002/atx/" target="_blank" rel="noopener">atx</a> 形式。</p>
<p>Setext 形式是用底线的形式，利用 <code>=</code> （最高阶标题）和 <code>-</code> （第二阶标题），例如：</p>
<pre><code>This is an H1
=============

This is an H2
-------------
</code></pre><p>任何数量的 <code>=</code> 和 <code>-</code> 都可以有效果。</p>
<p>Atx 形式则是在行首插入 1 到 6 个 <code>#</code> ，对应到标题 1 到 6 阶，例如：</p>
<pre><code># This is an H1

## This is an H2

###### This is an H6
</code></pre><p>你可以选择性地「关闭」atx 样式的标题，这纯粹只是美观用的，若是觉得这样看起来比较舒适，你就可以在行尾加上 <code>#</code>，而行尾的 <code>#</code> 数量也不用和开头一样（行首的井字数量决定标题的阶数）：</p>
<pre><code># This is an H1 #

## This is an H2 ##

### This is an H3 ######
</code></pre><h3 id="blockquote">Blockquotes</h3>

<p>Markdown 使用 email 形式的区块引言，如果你很熟悉如何在 email 信件中引言，你就知道怎么在 Markdown 文件中建立一个区块引言，那会看起来像是你强迫断行，然后在每行的最前面加上 <code>&gt;</code> ：</p>
<pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,
&gt; consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.
&gt; Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.
&gt;
&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse
&gt; id sem consectetuer libero luctus adipiscing.
</code></pre><p>Markdown 也允许你只在整个段落的第一行最前面加上 <code>&gt;</code> ：</p>
<pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,
consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.
Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.

&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse
id sem consectetuer libero luctus adipiscing.
</code></pre><p>区块引言可以有阶层（例如：引言内的引言），只要根据层数加上不同数量的 <code>&gt;</code> ：</p>
<pre><code>&gt; This is the first level of quoting.
&gt;
&gt; &gt; This is nested blockquote.
&gt;
&gt; Back to the first level.
</code></pre><p>引言的区块内也可以使用其他的 Markdown 语法，包括标题、列表、程序代码区块等：</p>
<pre><code>&gt; ## This is a header.
&gt;
&gt; 1.   This is the first list item.
&gt; 2.   This is the second list item.
&gt;
&gt; Here&apos;s some example code:
&gt;
&gt;     return shell_exec(&quot;echo $input | $markdown_script&quot;);
</code></pre><p>任何标准的文本编辑器都能简单地建立 email 样式的引言，例如 BBEdit ，你可以选取文字后然后从选单中选择<em>增加引言阶层</em>。</p>
<h3 id="list">清单</h3>

<p>Markdown 支持有序列表和无序列表。</p>
<p>无序清单使用星号、加号或是减号作为列表标记：</p>
<pre><code>*   Red
*   Green
*   Blue
</code></pre><p>等同于：</p>
<pre><code>+   Red
+   Green
+   Blue
</code></pre><p>也等同于：</p>
<pre><code>-   Red
-   Green
-   Blue
</code></pre><p>有序列表则使用数字接着一个英文句点：</p>
<pre><code>1.  Bird
2.  McHale
3.  Parish
</code></pre><p>很重要的一点是，你在列表标记上使用的数字并不会影响输出的 HTML 结果，上面的列表所产生的 HTML 标记为：</p>
<pre><code>&lt;ol&gt;
&lt;li&gt;Bird&lt;/li&gt;
&lt;li&gt;McHale&lt;/li&gt;
&lt;li&gt;Parish&lt;/li&gt;
&lt;/ol&gt;
</code></pre><p>如果你的列表标记写成：</p>
<pre><code>1.  Bird
1.  McHale
1.  Parish
</code></pre><p>或甚至是：</p>
<pre><code>3. Bird
1. McHale
8. Parish
</code></pre><p>你都会得到完全相同的 HTML 输出。重点在于，你可以让 Markdown 文件的列表数字和输出的结果相同，或是你懒一点，你可以完全不用在意数字的正确性。</p>
<p>如果你使用懒惰的写法，建议第一个项目最好还是从 1. 开始，因为 Markdown 未来可能会支持有序列表的 start 属性。</p>
<p>列表项目标记通常是放在最左边，但是其实也可以缩排，最多三个空白，项目标记后面则一定要接着至少一个空白或 tab。</p>
<p>要让清单看起来更漂亮，你可以把内容用固定的缩排整理好：</p>
<pre><code>*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.
    Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,
    viverra nec, fringilla in, laoreet vitae, risus.
*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.
    Suspendisse id sem consectetuer libero luctus adipiscing.
</code></pre><p>但是如果你很懒，那也不一定需要：</p>
<pre><code>*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.
Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,
viverra nec, fringilla in, laoreet vitae, risus.
*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.
Suspendisse id sem consectetuer libero luctus adipiscing.
</code></pre><p>如果列表项目间用空行分开， Markdown 会把项目的内容在输出时用 <code>&lt;p&gt;</code><br>标签包起来，举例来说：</p>
<pre><code>*   Bird
*   Magic
</code></pre><p>会被转换为：</p>
<pre><code>&lt;ul&gt;
&lt;li&gt;Bird&lt;/li&gt;
&lt;li&gt;Magic&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>但是这个：</p>
<pre><code>*   Bird

*   Magic
</code></pre><p>会被转换为：</p>
<pre><code>&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Bird&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Magic&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</code></pre><p>列表项目可以包含多个段落，每个项目下的段落都必须缩排 4 个空白或是一个 tab ：</p>
<pre><code>1.  This is a list item with two paragraphs. Lorem ipsum dolor
    sit amet, consectetuer adipiscing elit. Aliquam hendrerit
    mi posuere lectus.

    Vestibulum enim wisi, viverra nec, fringilla in, laoreet
    vitae, risus. Donec sit amet nisl. Aliquam semper ipsum
    sit amet velit.

2.  Suspendisse id sem consectetuer libero luctus adipiscing.
</code></pre><p>如果你每行都有缩排，看起来会看好很多，当然，再次地，如果你很懒惰，Markdown 也允许：</p>
<pre><code>*   This is a list item with two paragraphs.

    This is the second paragraph in the list item. You&apos;re
only required to indent the first line. Lorem ipsum dolor
sit amet, consectetuer adipiscing elit.

*   Another item in the same list.
</code></pre><p>如果要在列表项目内放进引言，那 <code>&gt;</code> 就需要缩排：</p>
<pre><code>*   A list item with a blockquote:

    &gt; This is a blockquote
    &gt; inside a list item.
</code></pre><p>如果要放程序代码区块的话，该区块就需要缩排<em>两次</em>，也就是 8 个空白或是两个 tab：</p>
<pre><code>*   A list item with a code block:

        &lt;code goes here&gt;
</code></pre><p>当然，项目列表很可能会不小心产生，像是下面这样的写法：</p>
<pre><code>1986. What a great season.
</code></pre><p>换句话说，也就是在行首出现<em>数字-句点-空白</em>，要避免这样的状况，你可以在句点前面加上反斜杠。</p>
<pre><code>1986\. What a great season.
</code></pre><h3 id="precode">程序代码区块</h3>

<p>和程序相关的写作或是卷标语言原始码通常会有已经排版好的程序代码区块，通常这些区块我们并不希望它以一般段落文件的方式去排版，而是照原来的样子显示，Markdown 会用 <code>&lt;pre&gt;</code> 和 <code>&lt;code&gt;</code> 标签来把程序代码区块包起来。</p>
<p>要在 Markdown 中建立程序代码区块很简单，只要简单地缩排 4 个空白或是 1 个 tab 就可以，例如，下面的输入：</p>
<pre><code>This is a normal paragraph:

    This is a code block.
</code></pre><p>Markdown 会转换成：</p>
<pre><code>&lt;p&gt;This is a normal paragraph:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;This is a code block.
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>这个每行一阶的缩排（4 个空白或是 1 个 tab），都会被移除，例如：</p>
<pre><code>Here is an example of AppleScript:

    tell application &quot;Foo&quot;
        beep
    end tell
</code></pre><p>会被转换为：</p>
<pre><code>&lt;p&gt;Here is an example of AppleScript:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;tell application &quot;Foo&quot;
    beep
end tell
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>一个程序代码区块会一直持续到没有缩排的那一行（或是文件结尾）。</p>
<p>在程序代码区块里面， <code>&amp;</code> 、 <code>&lt;</code> 和 <code>&gt;</code> 会自动转成 HTML 实体，这样的方式让你非常容易使用 Markdown 插入范例用的 HTML 原始码，只需要复制贴上，再加上缩排就可以了，剩下的 Markdown 都会帮你处理，例如：</p>
<pre><code>&lt;div class=&quot;footer&quot;&gt;
    &amp;copy; 2004 Foo Corporation
&lt;/div&gt;
</code></pre><p>会被转换为：</p>
<pre><code>&lt;pre&gt;&lt;code&gt;&amp;lt;div class=&quot;footer&quot;&amp;gt;
    &amp;amp;copy; 2004 Foo Corporation
&amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
</code></pre><p>程序代码区块中，一般的 Markdown 语法不会被转换，像是星号便只是星号，这表示你可以很容易地以 Markdown 语法撰写 Markdown 语法相关的文件。</p>
<h3 id="hr">分隔线</h3>

<p>你可以在一行中用三个或以上的星号、减号、底线来建立一个分隔线，行内不能有其他东西。你也可以在星号中间插入空白。下面每种写法都可以建立分隔线：</p>
<pre><code>* * *

***

*****

- - -

---------------------------------------
</code></pre><hr>
<h2 id="span">区段元素</h2>

<h3 id="link">连结</h3>

<p>Markdown 支持两种形式的链接语法： <em>行内</em>和<em>参考</em>两种形式。</p>
<p>不管是哪一种，链接的文字都是用 [方括号] 来标记。</p>
<p>要建立一个行内形式的连结，只要在方块括号后面马上接着括号并插入网址连结即可，如果你还想要加上链接的 title 文字，只要在网址后面，用双引号把 title 文字包起来即可，例如：</p>
<pre><code>This is [an example](http://example.com/ &quot;Title&quot;) inline link.

[This link](http://example.net/) has no title attribute.
</code></pre><p>会产生：</p>
<pre><code>&lt;p&gt;This is &lt;a href=&quot;http://example.com/&quot; title=&quot;Title&quot;&gt;
an example&lt;/a&gt; inline link.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://example.net/&quot;&gt;This link&lt;/a&gt; has no
title attribute.&lt;/p&gt;
</code></pre><p>如果你是要链接到同样主机的资源，你可以使用相对路径：</p>
<pre><code>See my [About](/about/) page for details.   
</code></pre><p>参考形式的连结使用另外一个方括号接在链接文字的括号后面，而在第二个方括号里面要填入用以辨识链接的标签：</p>
<pre><code>This is [an example][id] reference-style link.
</code></pre><p>你也可以选择性地在两个方括号中间加上空白：</p>
<pre><code>This is [an example] [id] reference-style link.
</code></pre><p>接着，在文件的任意处，你可以把这个标签的链接内容定义出来：</p>
<pre><code>[id]: http://example.com/  &quot;Optional Title Here&quot;
</code></pre><p>连结定义的形式为：</p>
<ul>
<li>方括号，里面输入链接的辨识用标签</li>
<li>接着一个冒号</li>
<li>接着一个以上的空白或 tab</li>
<li>接着连结的网址</li>
<li>选择性地接着 title 内容，可以用单引号、双引号或是括号包着</li>
</ul>
<p>下面这三种连结的定义都是相同：</p>
<pre><code>[foo]: http://example.com/  &quot;Optional Title Here&quot;
[foo]: http://example.com/  &apos;Optional Title Here&apos;
[foo]: http://example.com/  (Optional Title Here)
</code></pre><p><strong>请注意：</strong>有一个已知的问题是 Markdown.pl 1.0.1 会忽略单引号包起来的连结 title。</p>
<p>连结网址也可以用方括号包起来：</p>
<pre><code>[id]: &lt;http://example.com/&gt;  &quot;Optional Title Here&quot;
</code></pre><p>你也可以把 title 属性放到下一行，也可以加一些缩排，网址太长的话，这样会比较好看：</p>
<pre><code>[id]: http://example.com/longish/path/to/resource/here
    &quot;Optional Title Here&quot;
</code></pre><p>网址定义只有在产生连结的时候用到，并不会直接出现在文件之中。</p>
<p>链接辨识卷标可以有字母、数字、空白和标点符号，但是并<em>不</em>区分大小写，因此下面两个连结是一样的：</p>
<pre><code>[link text][a]
[link text][A]
</code></pre><p><em>默认的链接卷标</em>功能让你可以省略指定链接标签，这种情形下，链接卷标和链接文字会视为相同，要用默认链接卷标只要在链接文字后面加上一个空的方括号，如果你要让 “Google” 连结到 google.com，你可以简化成：</p>
<pre><code>[Google][]
</code></pre><p>然后定义连结内容：</p>
<pre><code>[Google]: http://google.com/
</code></pre><p>由于链接文字可能包含空白，所以这种简化的标签内也可以包含多个文字：</p>
<pre><code>Visit [Daring Fireball][] for more information.
</code></pre><p>然后接着定义连结：</p>
<pre><code>[Daring Fireball]: http://daringfireball.net/
</code></pre><p>连结的定义可以放在文件中的任何一个地方，我比较偏好直接放在连结出现段落的后面，你也可以把它放在文件最后面，就像是批注一样。</p>
<p>下面是一个参考式链接的范例：</p>
<pre><code>I get 10 times more traffic from [Google] [1] than from
[Yahoo] [2] or [MSN] [3].

  [1]: http://google.com/        &quot;Google&quot;
  [2]: http://search.yahoo.com/  &quot;Yahoo Search&quot;
  [3]: http://search.msn.com/    &quot;MSN Search&quot;
</code></pre><p>如果改成用连结名称的方式写：</p>
<pre><code>I get 10 times more traffic from [Google][] than from
[Yahoo][] or [MSN][].

  [google]: http://google.com/        &quot;Google&quot;
  [yahoo]:  http://search.yahoo.com/  &quot;Yahoo Search&quot;
  [msn]:    http://search.msn.com/    &quot;MSN Search&quot;
</code></pre><p>上面两种写法都会产生下面的 HTML。</p>
<pre><code>&lt;p&gt;I get 10 times more traffic from &lt;a href=&quot;http://google.com/&quot;
title=&quot;Google&quot;&gt;Google&lt;/a&gt; than from
&lt;a href=&quot;http://search.yahoo.com/&quot; title=&quot;Yahoo Search&quot;&gt;Yahoo&lt;/a&gt;
or &lt;a href=&quot;http://search.msn.com/&quot; title=&quot;MSN Search&quot;&gt;MSN&lt;/a&gt;.&lt;/p&gt;
</code></pre><p>下面是用行内形式写的同样一段内容的 Markdown 文件，提供作为比较之用：</p>
<pre><code>I get 10 times more traffic from [Google](http://google.com/ &quot;Google&quot;)
than from [Yahoo](http://search.yahoo.com/ &quot;Yahoo Search&quot;) or
[MSN](http://search.msn.com/ &quot;MSN Search&quot;).
</code></pre><p>参考式的连结其实重点不在于它比较好写，而是它比较好读，比较一下上面的范例，使用参考式的文章本身只有 81 个字符，但是用行内形式的连结却会增加到 176 个字符，如果是用纯 HTML 格式来写，会有 234 个字符，在 HTML 格式中，卷标比文字还要多。</p>
<p>使用 Markdown 的参考式连结，可以让文件更像是浏览器最后产生的结果，让你可以把一些标记相关的信息移到段落文字之外，你就可以增加连结而不让文章的阅读感觉被打断。</p>
<h3 id="em">强调</h3>

<p>Markdown 使用星号（<code>*</code>）和底线（<code>_</code>）作为标记强调字词的符号，被 <code>*</code> 或 <code>_</code> 包围的字词会被转成用 <code>&lt;em&gt;</code> 标签包围，用两个 <code>*</code> 或 <code>_</code> 包起来的话，则会被转成 <code>&lt;strong&gt;</code>，例如：</p>
<pre><code>*single asterisks*

_single underscores_

**double asterisks**

__double underscores__
</code></pre><p>会转成：</p>
<pre><code>&lt;em&gt;single asterisks&lt;/em&gt;

&lt;em&gt;single underscores&lt;/em&gt;

&lt;strong&gt;double asterisks&lt;/strong&gt;

&lt;strong&gt;double underscores&lt;/strong&gt;
</code></pre><p>你可以随便用你喜欢的样式，唯一的限制是，你用什么符号开启卷标，就要用什么符号结束。</p>
<p>强调也可以直接插在文字中间：</p>
<pre><code>un*frigging*believable
</code></pre><p>但是如果你的 <code>*</code> 和 <code>_</code> 两边都有空白的话，它们就只会被当成普通的符号。</p>
<p>如果要在文字前后直接插入普通的星号或底线，你可以用反斜杠：</p>
<pre><code>\*this text is surrounded by literal asterisks\*
</code></pre><h3 id="code">程序代码</h3>

<p>如果要标记一小段行内程序代码，你可以用反引号把它包起来（<code>`</code>），例如：</p>
<pre><code>Use the `printf()` function.
</code></pre><p>会产生：</p>
<pre><code>&lt;p&gt;Use the &lt;code&gt;printf()&lt;/code&gt; function.&lt;/p&gt;
</code></pre><p>如果要在程序代码区段内插入反引号，你可以用多个反引号来开启和结束程序代码区段：</p>
<pre><code>``There is a literal backtick (`) here.``
</code></pre><p>这段语法会产生：</p>
<pre><code>&lt;p&gt;&lt;code&gt;There is a literal backtick (`) here.&lt;/code&gt;&lt;/p&gt;
</code></pre><p>程序代码区段的起始和结束端都可以放入一个空白，起始端后面一个，结束端前面一个，这样你就可以在区段的一开始就插入反引号：</p>
<pre><code>A single backtick in a code span: `` ` ``

A backtick-delimited string in a code span: `` `foo` ``
</code></pre><p>会产生：</p>
<pre><code>&lt;p&gt;A single backtick in a code span: &lt;code&gt;`&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;A backtick-delimited string in a code span: &lt;code&gt;`foo`&lt;/code&gt;&lt;/p&gt;
</code></pre><p>在程序代码区段内，<code>&amp;</code> 和方括号都会被转成 HTML 实体，这样会比较容易插入 HTML 原始码，Markdown 会把下面这段：</p>
<pre><code>Please don&apos;t use any `&lt;blink&gt;` tags.
</code></pre><p>转为：</p>
<pre><code>&lt;p&gt;Please don&apos;t use any &lt;code&gt;&amp;lt;blink&amp;gt;&lt;/code&gt; tags.&lt;/p&gt;
</code></pre><p>你也可以这样写：</p>
<pre><code>`&amp;#8212;` is the decimal-encoded equivalent of `&amp;mdash;`.
</code></pre><p>以产生：</p>
<pre><code>&lt;p&gt;&lt;code&gt;&amp;amp;#8212;&lt;/code&gt; is the decimal-encoded
equivalent of &lt;code&gt;&amp;amp;mdash;&lt;/code&gt;.&lt;/p&gt;
</code></pre><h3 id="img">图片</h3>

<p>很明显地，要在纯文本应用中设计一个 「自然」的语法来插入图片是有一定难度的。</p>
<p>Markdown 使用一种和链接很相似的语法来标记图片，同样也允许两种样式： <em>行内</em>和<em>参考</em>。</p>
<p>行内图片的语法看起来像是：</p>
<pre><code>![Alt text](/path/to/img.jpg)

![Alt text](/path/to/img.jpg &quot;Optional title&quot;)
</code></pre><p>详细叙述如下：</p>
<ul>
<li>一个惊叹号 <code>!</code></li>
<li>接着一对方括号，里面放上图片的替换文字</li>
<li>接着一对普通括号，里面放上图片的网址，最后还可以用引号包住并加上<br>选择性的 ‘title’ 文字。</li>
</ul>
<p>参考式的图片语法则长得像这样：</p>
<pre><code>![Alt text][id]
</code></pre><p>「id」是图片参考的名称，图片参考的定义方式则和连结参考一样：</p>
<pre><code>[id]: url/to/image  &quot;Optional title attribute&quot;
</code></pre><p>到目前为止， Markdown 还没有办法指定图片的宽高，如果你需要的话，你可以使用普通的 <code>&lt;img&gt;</code> 标签。</p>
<hr>
<h2 id="misc">其它</h2>

<h3 id="autolink">自动连结</h3>

<p>Markdown 支持比较简短的自动连结形式来处理网址和电子邮件信箱，只要是用方括号包起来， Markdown 就会自动把它转成链接，链接的文字就和链接位置一样，例如：</p>
<pre><code>&lt;http://example.com/&gt;
</code></pre><p>Markdown 会转为：</p>
<pre><code>&lt;a href=&quot;http://example.com/&quot;&gt;http://example.com/&lt;/a&gt;
</code></pre><p>自动的邮件连结也很类似，只是 Markdown 会先做一个编码转换的过程，把文字字符转成 16 进位码的 HTML 实体，这样的格式可以混淆一些不好的信箱地址收集机器人，例如：</p>
<pre><code>&lt;address@example.com&gt;
</code></pre><p>Markdown 会转成：</p>
<pre><code>&lt;a href=&quot;&amp;#x6D;&amp;#x61;i&amp;#x6C;&amp;#x74;&amp;#x6F;:&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;
&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;
&amp;#109;&quot;&gt;&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;
&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&lt;/a&gt;
</code></pre><p>在浏览器里面，这段字符串会变成一个可以点击的「<a href="mailto:address@example.com" target="_blank" rel="noopener">address@example.com</a>」连结。</p>
<p>（这种作法虽然可以混淆不少的机器人，但并无法全部挡下来，不过这样也比什么都不做好些。无论如何，公开你的信箱终究会引来广告信件的。）</p>
<h3 id="backslash">跳脱字符</h3>

<p>Markdown 可以利用反斜杠来插入一些在语法中有其它意义的符号，例如：如果你想要用星号加在文字旁边的方式来做出强调效果（但不用 <code>&lt;em&gt;</code> 标签），你可以在星号的前面加上反斜杠：</p>
<pre><code>\*literal asterisks\*
</code></pre><p>Markdown 支持在下面这些符号前面加上反斜杠来帮助插入普通的符号：</p>
<pre><code>\   反斜杠
`   反引号
*   星号
_   底线
{}  大括号
[]  方括号
()  括号
#   井字号
+    加号
-    减号
.   英文句点
!   惊叹号
</code></pre><h2 id="acknowledgement">感谢</h2>

<p>感谢 <a href="https://twitter.com/#!/leafy7382" target="_blank" rel="noopener">leafy7382</a> 协助翻译，<a href="http://iamhlb.com/" target="_blank" rel="noopener">hlb</a>、<a href="http://twitter.com/randylien" target="_blank" rel="noopener">Randylien</a> 帮忙润稿，<a href="https://twitter.com/#!/ethantw" target="_blank" rel="noopener">ethantw</a> 的<a href="http://ethantw.net/projects/han/" target="_blank" rel="noopener">汉字标准格式・CSS Reset</a>， <a href="http://kidwm.net/" target="_blank" rel="noopener">WM</a> 回报文字错误。</p>

          
        
      
    </div>
    
    
    



    

    

    


    <footer class="post-footer">
      

      

      

      <div>
        
      </div>

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/2018/07/26/ListView-footer-dividers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Horace Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/07/26/ListView-footer-dividers/" itemprop="url">ListView footer dividers</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-26T13:59:57+08:00">
                2018-07-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  189
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ListView的顶部和底部怎么增加分隔线</p>
<hr>
<p>首先，我们先来了解ListView的两个属性以及它们的API解析</p>
<blockquote>
<p>android:headerDividersEnabled:  When set to false, the ListView will not draw the divider after each header view. [boolean]</p>
</blockquote>
<blockquote>
<p>android:footerDividersEnabled:   When set to false, the ListView will not draw the divider before each footer view. [boolean]</p>
</blockquote>
<p>可见，这里两个属性都只对HeaderView和FooterView有效，如果你没有在ListView加入HeaderView或者FooterView，无论设置什么值，都是没有作用的。</p>
<p><img src="/blog/2018/07/26/ListView-footer-dividers/footer.jpg" alt="footer"></p>
<p>那么，如何为listview设置顶部和底部的间隔线呢，是不是要为listiew的每一个item在布局中设置分割线呢？</p>
<p>这里列举一种比较简单的办法：</p>
<p>在xml中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android:headerDividersEnabled=<span class="string">"true"</span></span><br><span class="line">android:footerDividersEnabled=<span class="string">"true"</span></span><br></pre></td></tr></table></figure></p>
<p>在代码中：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">listView.addHeaderView(<span class="keyword">new</span> View(<span class="keyword">this</span>));</span><br><span class="line">listView.addFooterView(<span class="keyword">new</span> View(<span class="keyword">this</span>));</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    



    

    

    


    <footer class="post-footer">
      

      

      

      <div>
        
      </div>

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/2018/07/21/Android-进程状态整理和常驻service实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Horace Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/07/21/Android-进程状态整理和常驻service实践/" itemprop="url">Android 进程状态整理和常驻service实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-21T15:49:41+08:00">
                2018-07-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,029
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>lowmeorykiller中进程的分类以及各类进程的adj值</p>
<pre><code>在Android的lowmemroykiller机制中，会对于所有进程进行分类，对于每一类别的进程会有其oom_adj值的取值范围，oom_adj值越高则代表进程越不重要，在系统执行低杀操作时，会从oom_adj值越高的开始杀。系统lowmemeorykiller机制下对于进程的级别的以变量的形式定义在framework/base/core/java/com/android/server/am/ProcessList.java类中，可总结成下表：
</code></pre><p><img src="/blog/2018/07/21/Android-进程状态整理和常驻service实践/process.png" alt="进程图"></p>
<p>再补充介绍一下：</p>
<p>1.AMS角度对于进程的分级       </p>
<p>上表带分级只是从lowmemroykiller角度来分的，时用于lowmemeorykiller执行杀进程操作，但是从android的系统管理角度看，即是从AMS执行相关逻辑时，又有一套自己的分级机制，当然这两套机制也有着很多互通的点。AMS角度的级别划分以变量的形式定义在framework/base/core/java/android/app/ActivityManager.java类中，以PROCESS_STATE开头的变量。</p>
<p>2.没有stopService其内含activity的后台进程</p>
<pre><code>这类进程从lowmemorykiller角度是划分为cached，因为如果这类进程往往占有较大的内存，这类含有activity的后台进程往往占有较大内存，所以即使这类进程包含了Service，lowmemorykiller的机制也会更加倾向于优先杀死这类进程。

但是一般启动了服务的进程往往是希望服务在后台能够执行某些任务，这样看是不希望这些服务因为进程被杀而过早的被终止的，那如何调和这种矛盾呢？正确的做法是，对于期望较长时间留在后台的服务，应该将服务运行在单独的进程里，即是UI进程与Servie进程分离，这样期望长时间留在后台的Serivce会存在与一个被lmk分类为Service 进程的服务而获得较小的Adj值，而占有大量内存的UI进程则会分类为Cached进程，能够在需要的时候更快地被回收。

还有一点，这类进程虽然被lmk划分为cached进程，但是从ams角度是被划分为PROCESS_STATE_SERVICE这个类别的，即视为服务进程，在ams相关流程中也是以服务进程来执行相关逻辑的，此外在使用dumpsys meminfo查看所有进程时，这类进程也是被列在B service这个类别的。
</code></pre><p>3.A-Service与B-Service的划分</p>
<pre><code>所有启动了服务的进程，且该服务所在的进程没有显示过UI，且该服务未执行startForeground（执行后会变为perveptible服务）动作，那该进程则为A-Service与B-Service中的一种。然后根据这类服务进程所处于Lru进程表中的位置，前1/3点服务为A-Service，其余的则为B-Service。
</code></pre><p>4.perceptible的标准</p>
<pre><code>perceptible名为可感知的进程，但并不是说能够感知到进程就一定表示该进程属于perveptible进程，比如播放音乐的进程活着状态栏上有通知的进程，虽然能够感知到进程的存在，但是不代表进程一定时perceptible类别的进程。决定该进程是否属于perceptible进程并未进程的可感知性，而是该进程的服务是否执行了startForeground动作。
</code></pre><p>使用命令可以打出进程所属service的状态信息：</p>
<p>以今日头条为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dumpsys activity services com.ss.android.article.news</span><br></pre></td></tr></table></figure>
<p><img src="/blog/2018/07/21/Android-进程状态整理和常驻service实践/2018-07-26_161152.png" alt="服务图"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell</span><br><span class="line">ps | grep com.ss.android.article.news</span><br><span class="line">cat proc/<span class="number">9839</span>/oom_adj</span><br></pre></td></tr></table></figure>
<p><img src="/blog/2018/07/21/Android-进程状态整理和常驻service实践/2018-07-26_161744.png" alt="进程adj图"></p>
<p>对于常驻Service，通常使用绑定托盘的方式使之成为前台service，这样的adj值会从5或者8变为2，一般是不会清理掉的。</p>
<p>常驻Service方案除了基本的sticky之外，可以参考github上<a href="https://github.com/D-clock/AndroidDaemonService" target="_blank" rel="noopener">优雅的常驻service</a>.原理是通过设置相同的notification ID 设置前台service，stopInnerService后，原service会被认定为前台service，并且不会弹出通知栏。</p>
<blockquote>
<p>注意： 该方案在Android 7.1 及以上版本会弹出通知栏，这个其实是goolge里的漏洞，在Android 7.1上已经修复。</p>
</blockquote>

          
        
      
    </div>
    
    
    



    

    

    


    <footer class="post-footer">
      

      

      

      <div>
        
      </div>

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/2018/07/21/各平台离线日志开关/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Horace Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/07/21/各平台离线日志开关/" itemprop="url">各平台离线日志开关</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-21T10:20:06+08:00">
                2018-07-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,851
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  14
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以下是部分手机抓取日志方法</p>
<h3 id="360手机"><a href="#360手机" class="headerlink" title="360手机"></a>360手机</h3><hr>
<p>1） 在桌面的【其他应用】文件夹找到【用户反馈】，或通过搜索找到【用户反馈】<br>2 )  点击系统问题反馈<br>3 )  等复现问题，让问题出现2～3次<br>4 )  问题复现之后，直接到文件管理、本地存储，找到根目录下的“log或者mtklog”文件，将文件压缩后发送给工作人员</p>
<h3 id="MIUI："><a href="#MIUI：" class="headerlink" title="MIUI："></a>MIUI：</h3><hr>
<p>1） 在拨号键输入 *#*#284#*#* 来抓日志（不包括前后空格），过程可能要 1 分钟左右，成功后通知栏会提示；<br>2）等复现问题<br>3） 日志存放在 MIUI/debug_log 目录里，一个类似 bugreport-0227-14564.zip 的压缩包，将其发给我们</p>
<h3 id="魅族"><a href="#魅族" class="headerlink" title="魅族"></a>魅族</h3><hr>
<p>1） 去魅族应用市场下载一个叫“Log Report\ 的软件<br>2） 然后用它抓取LOG<br>3） 等问题复现后将log发给我们</p>
<h3 id="OPPO"><a href="#OPPO" class="headerlink" title="OPPO"></a>OPPO</h3><hr>
<p>1）在拨号键盘输入*#800# ，在弹出的界面选择第一项“Oppo Logkit”，再选取第一项“常规log日志信息抓取”，点击最下面一排按钮最左右的“保存log”，返回到上一界面<br>2）选择QXDM log抓取，选择打开Device_Log，运行一段时间后选择关闭Device_Log<br>3）问题出现后在进入“常规log日志信息抓取”点击暂停log，再点击转存log，<br>4）进入文件管理把文件夹OPPOlog里面最新的log和文件夹diag_logs里面的最新文件压缩后发送给相关的工作人员</p>
<h3 id="vivo"><a href="#vivo" class="headerlink" title="vivo"></a>vivo</h3><hr>
<p>在拨号键盘输入  *#*#112#*#*   进入bbklog<br>我们机型抓log的方法根据处理器的平台不同方法也不同，分高通处理器平台以及MTK处理器平台<br>mtk开启LOG方法：拔号界面输入*#*#112#*#* —&gt;MTKLogger,点最下方红色小键头,然后点返回键到主菜单，问题出现后，输入：*#*#112#*#*—&gt;MTKLogger，点红色的方框停止，log路径：文件管理根目录下的mtklog文件夹，将整个文件夹压缩后发给相关的工作人员<br>高通平台抓log的步骤：在拨号盘输入*#*#112#*#*即可进入Bbklog界面，ADBLog开关是总开关，开启后退出该界面。然后运行问题出现的软件或者打开问题出现的路径，log路径：文件管理根目录下的bbk_log文件夹，将整个文件夹压缩后发给相关的工作人员</p>
<h3 id="Nubia-UI："><a href="#Nubia-UI：" class="headerlink" title="Nubia UI："></a>Nubia UI：</h3><hr>
<p>拨号输入 *#62564#（旧版 ROM 为 *#983564#）进入自带的抓日志工具 Woodpecker</p>
<ol>
<li>软件报错、闪退相关问题：<br> a) 开启 MobileLog、NetworkLog 两项，并点击最下方开始箭头按钮<br> b) 退出工具界面，操作手机，使问题复现后，记下时间点，再次进入工具点击停止按钮<br> c) 在 内置存储/nubialog 文件夹里，将刚生成的 log 文件夹压缩，提交给工作人员并告知时间点</li>
<li>功耗问题：<br> a) 保证手机没有连接电脑、关闭 ModemLog 的情况下，重启手机，然后再开启 MobileLog 、NetworkLog、功耗Log 三项，记下当前电量，并点击最下方开始箭头按钮<br> b) 正常使用手机，观察耗电情况（至少30分钟）；若发现异常，记录时间点、当前电量、使用了什么软件，做了什么操作，并进入 Log 工具点击停止按钮<br> c) 在 内置存储/nubialog 文件夹里，将刚生成的 log 文件夹压缩，提交给工作人员并告知时间点</li>
</ol>
<h3 id="三星"><a href="#三星" class="headerlink" title="三星"></a>三星</h3><hr>
<ol>
<li>在系统拨号盘输入  *#9900#  进入sys Dump菜单</li>
<li>Delete dumpstate/logcat</li>
<li>Set Silent log : On to default</li>
<li>测试复现问题</li>
<li>*#9900#进入sys Dump菜单</li>
<li>Press Run dumpstate/logcat/modem log</li>
<li>press copy to SDcard(include CP Ramdump)</li>
<li>然后将内存根目录下的log文件夹压缩后发给工作人员</li>
</ol>
<h3 id="华为"><a href="#华为" class="headerlink" title="华为"></a>华为</h3><hr>
<ol>
<li>拨号键输入*#*#2846579#*#*，进入工程菜单</li>
<li>选择后台设置–Log设置-&gt;Log开关</li>
<li>点击页面最下方中间的播放按钮开始抓log，之后按钮会变成暂停图标，<br>点击后可以停止抓log，一旦选择了start，每次开机，log都会自动打开</li>
<li>复现问题后，需要先选择stop，这样log能完全保存下来；</li>
<li>打开LOG，正常使用手机，观察问题是否出现；</li>
<li>如果问题出现，请记录一下时间点，最好能截个问题现象的截图；在问题出现后过10分钟再停止LOG，确保整个过程的LOG都抓到；<br>（如果长时间不复现，考虑到LOG可能占满手机空间，造成LOG覆盖的情况，请定时清除一下LOG）</li>
<li>清除LOG方法为：首先将LOG停止；然后点击又下角的*桶图标，进入后选择“clear all”，然后选择确定，则手机存储中的LOG将会被全部清除；之后再打开LOG继续进行抓取；</li>
<li>停止LOG后将LOG导出压缩发送；<br>Log的保存路径是：手机内部存储或者SD卡存储根目录下会有一个“mtklog”的文件夹；请将此文件夹从手机中拖出后压缩发送给相关工作人员</li>
</ol>
<h3 id="联想（含Moto-z-z-play-M-国行）"><a href="#联想（含Moto-z-z-play-M-国行）" class="headerlink" title="联想（含Moto z/z play/M 国行）"></a>联想（含Moto z/z play/M 国行）</h3><hr>
<h3 id="3333-模式（MTK平台）"><a href="#3333-模式（MTK平台）" class="headerlink" title="####3333#模式（MTK平台）"></a>####3333#模式（MTK平台）</h3><ol>
<li>打开拨号界面，输入####3333#，打开工程模式</li>
<li>点击SystemLog后点击右上角设置按钮，进入设置界面，将三个log模式均点上，其他的暂时不要点<br>3.点击返回键，后点击屏幕下方中间的三角按钮，显示等待开始录取log，你会看到时间在动，这个时候退出，再通知栏也可以看到录取模式再运行<br>4.按照之前出现问题的操作方式再次进行操作，直至问题再次出现（即问题复现）<br>5.点击通知栏的log录取按钮，再次进入log录取界面，点击下方中间的方块按钮停止log录制<br>6.找到mtklog这个文件夹，将里面的内容拷出后压缩打包发给工程师<br>7.反馈完毕后为了避免log占用大量内存，按照步骤1进入工程模式后点击右下角的清除按钮（垃圾桶），然后选择需要清除的log，一般选择全部清除即可，然后返回退出即可。</li>
</ol>
<h3 id="8888-模式（高通平台）"><a href="#8888-模式（高通平台）" class="headerlink" title="####8888#模式（高通平台）"></a>####8888#模式（高通平台）</h3><ol>
<li>在拨号界面输入####8888#，进入工程模式</li>
<li>点选所有日志（或者根据问题类型选择）<br>3.点home键，然后按照之前的操作步骤复现问题<br>4.问题复现后再次按照步骤1进入工程模式点击保存日志<br>5.找到log这个文件夹，把里面的log拷出后打包发给工程师就ok了</li>
</ol>
<h3 id="金立"><a href="#金立" class="headerlink" title="金立"></a>金立</h3><hr>
<h3 id="高通平台"><a href="#高通平台" class="headerlink" title="高通平台"></a>高通平台</h3><ol>
<li>开机后，进入拨号界面，在拨号界面输入指令*#446633#</li>
<li>进入金立的log日志选项界面了，看到英文很头疼？放心，很简单的！下面我来介绍。</li>
<li>默认情况下，最上面两项Mobile Log和Kernel Log是打开的。遇到报错或者为了验证特殊问题时，如果是日常使用场景，不涉及到使用网络（WiFi、数据网络），打开它们就够了。</li>
<li>如果你反馈的问题与网络连接有关，那么一定要打开后面两项Modem Log和Net Log。（否则你做了无用功，工程师收到无效log也会感到心好累的= =！）modem log开启后会占用一定内存，这一点请注意，传完log记得及时清理，腾出存储空间。</li>
<li>接着看下面的Log Path选项，这个是log文件存储的位置选项，默认的就是Internal Storage（内置存储），所以这一项我们不用管。</li>
<li>大家注意到了吗，有一行小字，Start Automatically when Reboot，勾选这个选项后便于开机直接启动log记录器，而不需要每次都进拨号盘输入命令启动，尤其是验证死机重启的问题时它很有用。</li>
<li>最后也是最重要的一点，打开上面的所有选项后，一定记得点击绿色的“START”按钮。这时就会变成下面的界面了，log记录就开始了，我们就可以按返回键退出这个界面，执行各种操作，从而复现问题了。</li>
<li>最后的最后，复现了问题步骤以后，记得连接电脑，复制存储目录下的GNLogs文件夹（因机型与平台的不同，有些为diag_logs文件夹），最好压缩后发给工作人员</li>
</ol>
<h3 id="MTK平台"><a href="#MTK平台" class="headerlink" title="MTK平台"></a>MTK平台</h3><p>1、到手机的拨号界面，输入*#446633#，会进入工程模式的界面。如下图所示，然后手指向左侧滑动，进入Log and Debugging子项下的MTKLogger选项，点击进入<br>2、 默认界面如下，正常情况下直接开启即可。开启方法就是点击正下方的红色小三角，类似于播放器的图标一样。开启后会有一个等待动画，几秒钟后开始计时，就表明你已经开始记录log了。这时候就可以退出此界面去复现你遇到的问题了。（也就是操作一遍你遇到问题的过程）<br>PS：如果你对于log占用的空间比较在意，并且所反馈的问题确认与网络无关，可以在开启log之前，点击右上角的设置按钮，进入下方右侧图片中的界面，关闭ModemLog。这样记录下来的log体积会大大减少。<br>但如果你的问题跟网络有关（无论数据流量还是WiFi相关），请务必保持ModemLog在开启的状态，否则记录的log是没用的！<br>3、复现问题后，下拉状态栏，进入log抓取界面，然后点击按钮关闭log开关。进入文件管理器，找到mtklog文件夹，压缩后发给工作人员<br>4、 log抓取部分的教程到此就结束了。Log传完以后，手机里的log文件仍然占用着空间，你可以直接在文件管理器删除整个mtklog文件夹进行清理，也可以进入抓log界面，点击右下角的垃圾桶，进入后选择右下角的Clear All，即可完成清理</p>
<h3 id="一加"><a href="#一加" class="headerlink" title="一加"></a>一加</h3><hr>
<p>氢OS系统日志抓取步骤：</p>
<ol>
<li>打开拨号键盘输入*#800#——点击oneplus logkit；</li>
<li>勾选“保存log”；</li>
<li>点击“QXDM log抓取”；</li>
<li>点击“打开device log”；</li>
<li>返回操作使BUG复现；</li>
<li>问题复现后记录问题出现时间，等待几分钟；</li>
<li>将文件管理中“oem_log”文件夹拷出；</li>
<li>为了不占用更多手机容量，在LOG已经提取后，可以再次打开“常规log日志信息抓取”与“QXDM log抓取”，关闭log抓取以后点击“删除历史log”。<br>然后把提取的文件压缩后发我就可以了  </li>
</ol>
<h3 id="乐视"><a href="#乐视" class="headerlink" title="乐视"></a>乐视</h3><hr>
<ol>
<li>打开拨号页面，输入*#*#8888#*#* （或者打开问题反馈app，连续按5次左上角在线反馈后，会自动打开Log抓取设置页面）</li>
<li>进入抓取页面后，把所有log选项都打开</li>
<li>点击开始记录离线日志，点击后软件会在回后台运行记录日志</li>
<li>复现你所发现的bug或问题后，按照上面的方法再次进入Log抓取页，点击停止记录，选择复现了，保存日志。</li>
<li>保存日志后会自动打开在线反馈页面，请直接点返回键，放弃在线提交。(切记不要点提交!)</li>
<li>返回桌面，找到文件管理app打开。依次点击：手机储存→logs→ArchivedLogs。这时可以看到抓取的log日志就保存在ArchivedLogs文件夹下</li>
<li>把抓取的log日志压缩后可以发送给工程师们咯</li>
</ol>
<h3 id="酷派"><a href="#酷派" class="headerlink" title="酷派"></a>酷派</h3><hr>
<h3 id="MTK平台："><a href="#MTK平台：" class="headerlink" title="MTK平台："></a>MTK平台：</h3><p>一、 如何抓取日志？</p>
<ol>
<li>进入拨号盘，输入*20121220#进入工程模式，选择【MTK_Engineermode】。</li>
<li>左划到【Log and Debugging】下并点选【MTKLogger】。</li>
<li>点击图标抓取日志。<br>日志抓取是可home键挂后台并会在托盘显示日志正在运行提示，下拉托盘点击即可进入日志抓取界面。<br>注意：日志开启后，操作出现异常日志方有效，提供日志时同时提供问题发生时间点，以便定位问题。</li>
</ol>
<p>二、如何调整日志输出等级？<br>1、进入工程模式中后，进入日志输出等级，就是下面的截图<br>2、分别将Java log level和Cand C++ log level的日志等级调整为LOGV：<br>3、将Kernel log level的输出等级调整为最后的KERN_DEBUG：<br>三、如何保存日志？</p>
<ol>
<li>在日志抓取界面，点击结束图标，停止日志抓取。日志会自动保存到/storage/emulated/0/mtklog目录下。</li>
<li>进入文件管理器，在/storage/emulated/0/mtklog目录下，将【mdlog】、【mobilelog】、【netlog】三个文件夹一起压缩打包即可。<br>四、如何清除日志文件？</li>
<li>在日志抓取界面，点击删除图标，选择【CLEAR ALL】清除日志文件。<br>注意：长时间开启日志抓取会占用存储空间，建议及时清除日志文件。</li>
</ol>
<h3 id="高通平台："><a href="#高通平台：" class="headerlink" title="高通平台："></a>高通平台：</h3><p>方法如下：<br>1 、从拨号盘输入*20121220#进入到工程模式<br>2 、进入 日志输出等级<br>3、 按照如下的说明设置一下日志级别<br>       java log level 选择 LOGV (即第一项)<br>       c and c++ log level 选择  LOGV (即第一项)<br>       kernel log level 选择 KERN_DEBUG (即最后一项)<br>按照上面的设置之后，返回上一级<br>4、 进入 离线日志设置 进行如下的操作:<br>      (1)取消 离线日志开关  的钩钩,  然后依次点击菜单最后两行是 删除以前所有的日志 和 清除日志缓冲区。<br>      (2)进入 日志缓冲区类型，请勾选除最后一项“Elog日志转储”之外的所有选项，即勾选Main缓冲区，Radio缓 冲区，Events缓冲区，system缓冲区，网络日志转储，内核日志转储，QXDM日志转储。然后按  确定 ，请务必保证  QXDM日志转储  勾选上。<br>     (3)日志转储设为NO<br>     (4)完成上面的操作之后 ，重新将 离线日志开关 勾选上。<br>     (5)重启机器，按照你的操作步骤操作。<br>     (6)从/sdcard/log中把日志压缩发给我们，谢谢！</p>
<p>使用ADB抓取系统log<br>一、配置环境变量<br>电脑桌面上右击 计算机–&gt;属性–&gt;高级系统配置–&gt;环境变量，在 系统变量 中找到path（没有可以新建一个）。点击path后再变量值的开头加上你的路径“d:adb;”，切记路径最后还要带个分号。点击确定–&gt;确定，如此就完成了环境变量的配置。<br>二、抓log<br>将手机与电脑用数据线相连。<br>打开命令行（开始–&gt;附件–&gt;命令提示符），然后进行一下步骤：</p>
<ol>
<li>显示现在连接的手机设备：输入 adb devices  + 回车</li>
<li>抓log：输入 adb logcat + 回车</li>
<li>停止抓log：使用ctrl + c</li>
<li>将log导出：adb logcat &gt; d：1.txt（将log导出到d：/1.txt文件中<br>ADB工具下载地址：<a href="https://yunpan.cn/cWkyshMeDeKDf" target="_blank" rel="noopener">https://yunpan.cn/cWkyshMeDeKDf</a>  访问密码 8a91</li>
</ol>

          
        
      
    </div>
    
    
    



    

    

    


    <footer class="post-footer">
      

      

      

      <div>
        
      </div>

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="page-number" href="/blog/page/3/">3</a><a class="extend next" rel="next" href="/blog/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/blog/images/avatar.jpg"
                alt="Horace Zhao" />
            
              <p class="site-author-name" itemprop="name">Horace Zhao</p>
              <p class="site-description motion-element" itemprop="description">宁静以致远</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/blog/archives/">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/blog/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/blog/tags/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/blog/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:quintus_horace@outlook.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/quintushorace" target="_blank" title="Github">
                      
                        <i class="fa fa-fw fa-github"></i>Github</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/gutogu" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-globe"></i>CSDN</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/quintushorace" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-globe"></i>知乎</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com" title="Github" target="_blank">Github</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://stackoverflow.com" title="StackOverflow" target="_blank">StackOverflow</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://segmentfault.com" title="Segmentfault" target="_blank">Segmentfault</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Horace Zhao</span>

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>


  <span class="post-meta-divider">|</span>



  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共47.5k字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/blog/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blog/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    
    <!-- id: window.location.pathname,  -->

    







  





  

  

  

  
  

  

  

  


  
    <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
  

</body>
</html>
